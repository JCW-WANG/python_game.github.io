<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雙人對打遊戲 | Fighting Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff4d4d, #4d79ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0c0;
            margin-bottom: 30px;
        }

        /* 角色選擇介面 */
        .selection-screen {
            background: rgba(10, 15, 30, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .character-selection {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .character-card {
            background: #202538;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            min-width: 150px;
            border: 2px solid transparent;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
        }

        .character-card.selected-p1 {
            border-color: #ff4d4d;
            box-shadow: 0 0 15px #ff4d4d;
        }

        .character-card.selected-p2 {
            border-color: #4d79ff;
            box-shadow: 0 0 15px #4d79ff;
        }

        .character-card h4 {
            color: #ffcc00;
            margin-bottom: 5px;
        }

        .character-info {
            font-size: 0.9rem;
            color: #c0c0e0;
        }

        .start-btn {
            background: linear-gradient(90deg, #10b981, #059669);
            color: #fff;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 25px;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
            opacity: 0.5;
            pointer-events: none;
        }

        .start-btn.ready {
            opacity: 1;
            pointer-events: all;
        }

        .start-btn.ready:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.6);
        }

        /* 遊戲區域 */
        .game-area {
            position: relative;
            width: 100%;
            background: rgba(10, 15, 30, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            background: #0a0f1e;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 10;
        }
        
        .player-ui {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            min-width: 180px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: left;
        }
        
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .player-skill {
            font-size: 0.8rem;
            margin-top: 5px;
            color: #ffcc00;
        }
        
        .health-bar {
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .health-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        .player1-ui .health-fill {
            background: linear-gradient(90deg, #ff4d4d, #ff9999);
        }
        
        .player2-ui .health-fill {
            background: linear-gradient(90deg, #4d79ff, #99bbff);
        }
        
        .controls {
            display: none; /* 遊戲開始後才顯示 */
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .controls.visible {
            display: flex;
        }
        
        .control-card {
            background: rgba(20, 25, 45, 0.8);
            padding: 20px;
            border-radius: 10px;
            min-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-align: left;
        }
        
        .control-card h3 {
            margin-bottom: 15px;
            color: #ffcc00;
            text-align: center;
        }
        
        .key {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px 2px 5px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: monospace;
        }

        .control-card p {
            margin: 5px 0;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            display: none;
            z-index: 20;
        }
        
        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .restart-btn {
            background: linear-gradient(90deg, #ff9900, #ffcc00);
            color: #000;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 204, 0, 0.6);
        }
        
        footer {
            margin-top: 20px;
            color: #a0a0c0;
            font-size: 0.9rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-card {
                width: 100%;
                max-width: 350px;
            }
            
            .player-ui {
                min-width: 140px;
                padding: 10px;
            }
            
            .player-name {
                font-size: 1rem;
            }

            .character-selection {
                flex-direction: column;
            }
            
            .character-card {
                width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .ui-overlay {
                padding: 10px;
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            
            .player-ui {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>雙人對打遊戲</h1>
            <p class="subtitle">選擇你的英雄，與朋友一決高下！</p>
        </header>

        <div class="selection-screen" id="selectionScreen">
            <h2>選擇你的角色</h2>
            <div class="character-selection" id="characterSelection">
                </div>
            <button class="start-btn" id="startBtn">開始戰鬥！</button>
        </div>
        
        <div class="game-area" style="display: none;" id="gameArea">
            <canvas id="gameCanvas"></canvas>
            
            <div class="ui-overlay">
                <div class="player-ui player1-ui">
                    <div class="player-name">玩家 1: <span id="p1Name"></span></div>
                    <div class="health-bar">
                        <div class="health-fill" id="p1Health" style="width: 100%"></div>
                    </div>
                    <div>生命值: <span id="p1HealthText">100</span></div>
                    <div class="player-skill">技能 (F): <span id="p1SkillName"></span></div>
                </div>
                
                <div class="player-ui player2-ui">
                    <div class="player-name">玩家 2: <span id="p2Name"></span></div>
                    <div class="health-bar">
                        <div class="health-fill" id="p2Health" style="width: 100%"></div>
                    </div>
                    <div>生命值: <span id="p2HealthText">100</span></div>
                    <div class="player-skill">技能 (R Ctrl): <span id="p2SkillName"></span></div>
                </div>
            </div>
            
            <div class="game-over" id="gameOver">
                <h2 id="winnerText">玩家 1 獲勝！</h2>
                <p>遊戲結束，點擊按鈕重新開始</p>
                <button class="restart-btn" id="restartBtn">重新開始遊戲</button>
            </div>
        </div>
        
        <div class="controls" id="controls">
            <div class="control-card">
                <h3>玩家 1 控制</h3>
                <p><span class="key">W</span> 跳躍</p>
                <p><span class="key">A</span> 向左移動</p>
                <p><span class="key">D</span> 向右移動</p>
                <p><span class="key">F</span> **特殊技能**</p>
            </div>
            
            <div class="control-card">
                <h3>玩家 2 控制</h3>
                <p><span class="key">↑</span> 跳躍</p>
                <p><span class="key">←</span> 向左移動</p>
                <p><span class="key">→</span> 向右移動</p>
                <p><span class="key">R Ctrl</span> **特殊技能**</p>
            </div>
        </div>
        
        <footer>
            <p>專為 GitHub 設計 | 使用 HTML5 Canvas 和 JavaScript 開發</p>
        </footer>
    </div>

    <script>
        // --- 遊戲設定與角色資料 ---
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverScreen = document.getElementById('gameOver');
        const winnerText = document.getElementById('winnerText');
        const restartBtn = document.getElementById('restartBtn');
        const p1Health = document.getElementById('p1Health');
        const p2Health = document.getElementById('p2Health');
        const p1HealthText = document.getElementById('p1HealthText');
        const p2HealthText = document.getElementById('p2HealthText');
        const selectionScreen = document.getElementById('selectionScreen');
        const gameArea = document.getElementById('gameArea');
        const startBtn = document.getElementById('startBtn');
        const characterSelectionDiv = document.getElementById('characterSelection');
        const controlsDiv = document.getElementById('controls');

        // 顏色定義
        const colors = {
            background: '#0a0f1e',
            platform: '#4a5f8c',
            text: '#ffffff'
        };

        // 角色屬性定義
        const characters = [
            { id: 'fire_mage', name: '火焰法師', color: '#ff4d4d', skill: '火焰衝擊 (攻擊)', skillName: '火焰衝擊', dmg: 15, cd: 45, defense: 0.8 }, // 80% 傷害
            { id: 'ice_knight', name: '冰霜騎士', color: '#4d79ff', skill: '冰霜護甲 (防禦)', skillName: '冰霜護甲', dmg: 10, cd: 60, defense: 0.5 }, // 50% 傷害
            { id: 'shadow_ninja', name: '暗影忍者', color: '#8a2be2', skill: '瞬移突襲 (攻擊)', skillName: '瞬移突襲', dmg: 20, cd: 30, defense: 1.0 }, // 標準傷害
            { id: 'thunder_monk', name: '雷電武僧', color: '#ffd700', skill: '閃電踢 (攻防)', skillName: '閃電踢', dmg: 12, cd: 40, defense: 0.9 }, // 90% 傷害
            { id: 'earth_golem', name: '大地魔像', color: '#10b981', skill: '石牆術 (防禦)', skillName: '石牆術', dmg: 5, cd: 50, defense: 0.2 }, // 20% 傷害
        ];

        // 遊戲狀態變數
        let gameRunning = false;
        let selectedCharP1 = null;
        let selectedCharP2 = null;
        let player1 = null;
        let player2 = null;
        let platforms = [];

        // --- 初始化與事件處理 ---

        function resizeCanvas() {
            const container = document.querySelector('.game-area');
            if (container.style.display !== 'none') {
                canvas.width = container.clientWidth;
                canvas.height = Math.min(600, container.clientWidth * 0.75);
                createPlatforms();
            }
        }

        function createPlatforms() {
            platforms = [
                new Platform(0, canvas.height - 50, canvas.width, 50), // 地面
                new Platform(canvas.width * 0.2, canvas.height - 200, canvas.width * 0.15, 20), // 平台1
                new Platform(canvas.width * 0.65, canvas.height - 200, canvas.width * 0.15, 20), // 平台2
                new Platform(canvas.width * 0.35, canvas.height - 350, canvas.width * 0.3, 20), // 平台3
            ];
        }

        window.addEventListener('resize', resizeCanvas);

        // 繪製角色選擇卡片
        function renderCharacterSelection() {
            characterSelectionDiv.innerHTML = '';
            characters.forEach(char => {
                const card = document.createElement('div');
                card.className = 'character-card';
                card.id = `char-${char.id}`;
                card.innerHTML = `
                    <h4>${char.name}</h4>
                    <p class="character-info">生命: 100</p>
                    <p class="character-info">技能: ${char.skillName}</p>
                    <p class="character-info">防禦係數: ${char.defense * 100}%</p>
                `;
                card.addEventListener('click', () => handleCharacterSelect(char));
                characterSelectionDiv.appendChild(card);
            });
        }

        function handleCharacterSelect(char) {
            const cardElement = document.getElementById(`char-${char.id}`);
            const isP1Selected = cardElement.classList.contains('selected-p1');
            const isP2Selected = cardElement.classList.contains('selected-p2');

            if (!isP1Selected && selectedCharP1 === null) {
                selectedCharP1 = char;
                cardElement.classList.add('selected-p1');
            } else if (!isP2Selected && selectedCharP2 === null && selectedCharP1 !== char) {
                selectedCharP2 = char;
                cardElement.classList.add('selected-p2');
            } else if (isP1Selected) {
                cardElement.classList.remove('selected-p1');
                selectedCharP1 = null;
            } else if (isP2Selected) {
                cardElement.classList.remove('selected-p2');
                selectedCharP2 = null;
            }

            // 更新開始按鈕狀態
            if (selectedCharP1 && selectedCharP2) {
                startBtn.classList.add('ready');
            } else {
                startBtn.classList.remove('ready');
            }
        }

        startBtn.addEventListener('click', startGame);

        function startGame() {
            if (!selectedCharP1 || !selectedCharP2) return;

            selectionScreen.style.display = 'none';
            gameArea.style.display = 'block';
            controlsDiv.classList.add('visible');
            resizeCanvas(); // 確保 Canvas 尺寸正確

            // 初始化玩家
            player1 = new Player(100, canvas.height - 130, selectedCharP1, {
                up: 'KeyW',
                left: 'KeyA',
                right: 'KeyD',
                attack: 'KeyF'
            }, "玩家 1", 1);
            
            player2 = new Player(canvas.width - 150, canvas.height - 130, selectedCharP2, {
                up: 'ArrowUp',
                left: 'ArrowLeft',
                right: 'ArrowRight',
                attack: 'ControlRight'
            }, "玩家 2", 2);

            // 更新 UI 顯示
            document.getElementById('p1Name').textContent = selectedCharP1.name;
            document.getElementById('p2Name').textContent = selectedCharP2.name;
            document.getElementById('p1SkillName').textContent = selectedCharP1.skillName;
            document.getElementById('p2SkillName').textContent = selectedCharP2.skillName;

            gameRunning = true;
            gameLoop();
        }

        // --- 遊戲邏輯類別與函式 ---

        // 平台類
        class Platform {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
            
            draw() {
                ctx.fillStyle = colors.platform;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fillRect(this.x, this.y, this.width, 5);
            }
        }

        // 玩家類 (已大幅修改)
        class Player {
            constructor(x, y, char, controls, name, id) {
                this.id = id;
                this.x = x;
                this.y = y;
                this.width = 50;
                this.height = 80;
                this.color = char.color;
                this.name = name;
                this.char = char;

                this.speed = 5;
                this.jumpPower = 15;
                this.velY = 0;
                this.onGround = false;

                this.health = 100;
                this.controls = controls;
                this.facingRight = id === 1; // P1 預設面向右，P2 預設面向左

                this.attackCooldown = 0;
                this.skillCooldown = 0;
                this.skillActive = 0; // 技能持續時間
                this.isAttacking = false;
                this.isDefending = false;
            }
            
            draw() {
                // 繪製玩家本體
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // 攻擊/技能動畫
                if (this.isAttacking) {
                    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';
                    const attackX = this.facingRight ? this.x + this.width : this.x - 30;
                    ctx.fillRect(attackX, this.y, 30, this.height);
                }

                // 防禦/技能特效
                if (this.isDefending || this.skillActive > 0) {
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.rect(this.x - 5, this.y - 5, this.width + 10, this.height + 10);
                    ctx.stroke();
                }
                
                // 繪製眼睛（方向指示）
                ctx.fillStyle = '#ffffff';
                const eyeX = this.facingRight ? this.x + this.width - 15 : this.x + 15;
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 25, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 25, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            move(keys, platforms) {
                let dx = 0;
                // 水平移動
                if (keys[this.controls.left]) {
                    dx = -this.speed;
                    this.facingRight = false;
                }
                if (keys[this.controls.right]) {
                    dx = this.speed;
                    this.facingRight = true;
                }
                this.x += dx;
                
                // 確保玩家不會離開螢幕
                this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
                
                // 重力
                this.velY += 0.5;
                this.y += this.velY;
                
                // 碰撞檢測 - 平台
                this.onGround = false;
                for (const platform of platforms) {
                    // 檢查垂直碰撞
                    if (this.x < platform.x + platform.width &&
                        this.x + this.width > platform.x) {
                        
                        // 站在平台上 (從上方落下)
                        if (this.y + this.height > platform.y && 
                            this.y + this.height - this.velY <= platform.y) {
                            
                            this.y = platform.y - this.height;
                            this.velY = 0;
                            this.onGround = true;
                        }
                    }
                }
                
                // 碰撞檢測 - 地面
                if (this.y + this.height >= canvas.height) {
                    this.y = canvas.height - this.height;
                    this.velY = 0;
                    this.onGround = true;
                }
                
                // 跳躍
                if (keys[this.controls.up] && this.onGround) {
                    this.velY = -this.jumpPower;
                    this.onGround = false; // 離開地面
                }
            }
            
            // 特殊技能
            skill(otherPlayer) {
                if (this.skillCooldown === 0) {
                    this.skillCooldown = this.char.cd; // 設定冷卻時間

                    switch (this.char.id) {
                        case 'fire_mage':
                            // 火焰衝擊 (攻擊)
                            this.isAttacking = true;
                            this.skillActive = 10;
                            this.checkSkillHit(otherPlayer, this.char.dmg);
                            break;
                        case 'ice_knight':
                            // 冰霜護甲 (防禦)
                            this.isDefending = true;
                            this.skillActive = 180; // 持續 3 秒 (60 FPS * 3)
                            break;
                        case 'shadow_ninja':
                            // 瞬移突襲 (攻擊) - 簡單瞬移到對手附近並攻擊
                            this.x = otherPlayer.x + (this.facingRight ? -this.width * 2 : this.width * 2);
                            this.isAttacking = true;
                            this.skillActive = 10;
                            this.checkSkillHit(otherPlayer, this.char.dmg * 1.5); // 傷害提高
                            break;
                        case 'thunder_monk':
                            // 閃電踢 (攻防) - 攻擊並獲得短暫防禦
                            this.isAttacking = true;
                            this.skillActive = 10;
                            this.checkSkillHit(otherPlayer, this.char.dmg);
                            this.isDefending = true; // 附加短暫防禦
                            setTimeout(() => this.isDefending = false, 500); // 0.5秒後取消防禦
                            break;
                        case 'earth_golem':
                            // 石牆術 (防禦)
                            this.isDefending = true;
                            this.skillActive = 300; // 持續 5 秒
                            break;
                    }
                }
            }

            checkSkillHit(otherPlayer, damage) {
                const range = 100; // 攻擊距離
                if (Math.abs(this.x - otherPlayer.x) < range && Math.abs(this.y - otherPlayer.y) < this.height) {
                    otherPlayer.takeDamage(damage);
                }
            }

            takeDamage(baseDamage) {
                let damage = baseDamage;

                // 檢查是否處於防禦狀態或技能防禦中
                if (this.isDefending || this.skillActive > 0) {
                    // 使用角色的防禦係數
                    damage *= this.char.defense;
                }

                this.health -= damage;
                this.health = Math.max(0, this.health);
            }
            
            update(keys) {
                // 減少冷卻時間
                if (this.skillCooldown > 0) this.skillCooldown--;
                if (this.skillActive > 0) this.skillActive--;

                // 攻擊動畫結束
                if (this.isAttacking && this.skillActive === 0) {
                    this.isAttacking = false;
                }

                // 冰霜騎士和大地魔像技能結束時取消防禦
                if ((this.char.id === 'ice_knight' || this.char.id === 'earth_golem') && this.skillActive === 0) {
                    this.isDefending = false;
                }
            }
        }
        
        // 鍵盤狀態
        const keys = {};
        
        // 鍵盤事件監聽
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            if (!gameRunning) return;

            // 特殊技能觸發
            if (e.code === player1.controls.attack) {
                player1.skill(player2);
            }
            if (e.code === player2.controls.attack) {
                player2.skill(player1);
            }

            // 防止按鍵默認行為（例如方向鍵滾動頁面）
            if (['KeyW', 'KeyA', 'KeyS', 'KeyD', 'KeyF', 'ArrowUp', 'ArrowLeft', 'ArrowRight', 'ArrowDown', 'ControlRight'].includes(e.code)) {
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // 重新開始遊戲 (回到選擇畫面)
        restartBtn.addEventListener('click', () => {
            gameRunning = false;
            gameOverScreen.style.display = 'none';
            gameArea.style.display = 'none';
            controlsDiv.classList.remove('visible');
            selectionScreen.style.display = 'block';

            // 重置選擇狀態
            selectedCharP1 = null;
            selectedCharP2 = null;
            startBtn.classList.remove('ready');
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('selected-p1', 'selected-p2');
            });
            player1 = null;
            player2 = null;
        });
        
        // 遊戲主循環
        function gameLoop() {
            if (!gameRunning) return;

            // 清空畫布
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 繪製平台
            platforms.forEach(platform => platform.draw());
            
            // 更新玩家位置
            player1.move(keys, platforms);
            player2.move(keys, platforms);
            
            // 更新玩家狀態
            player1.update(keys);
            player2.update(keys);
            
            // 繪製玩家
            player1.draw();
            player2.draw();

            // 更新UI
            p1Health.style.width = `${Math.max(0, player1.health)}%`;
            p2Health.style.width = `${Math.max(0, player2.health)}%`;
            p1HealthText.textContent = Math.max(0, Math.ceil(player1.health));
            p2HealthText.textContent = Math.max(0, Math.ceil(player2.health));
            
            // 檢查遊戲結束條件
            if (player1.health <= 0 || player2.health <= 0) {
                gameRunning = false;
                const winner = player1.health <= 0 ? player2.name : player1.name;
                winnerText.textContent = `${winner} 獲勝！`;
                gameOverScreen.style.display = 'block';
                return;
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        // 首次初始化
        renderCharacterSelection();
    </script>
</body>
</html>
