<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é§•é§›æ¨¡æ“¬éŠæˆ²</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(to bottom, #1a2a3a, #0d1b2a);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #2a9d8f;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #e9c46a;
            text-shadow: 0 0 10px rgba(233, 196, 106, 0.5);
        }

        .game-area {
            display: flex;
            gap: 20px;
        }

        .game-canvas-container {
            flex: 3;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        #gameCanvas {
            width: 100%;
            height: 500px;
            background: #1e3a5f;
            display: block;
        }

        .game-controls {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel {
            background: rgba(42, 157, 143, 0.2);
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .panel h2 {
            color: #e9c46a;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid #2a9d8f;
            padding-bottom: 5px;
        }

        .vehicle-selection {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .vehicle-option {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .vehicle-option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .vehicle-option.selected {
            background: rgba(233, 196, 106, 0.3);
            border: 1px solid #e9c46a;
        }

        .vehicle-icon {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            background: #2a9d8f;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scenario-selection {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .scenario-btn {
            padding: 10px;
            background: rgba(42, 157, 143, 0.3);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .scenario-btn:hover {
            background: rgba(42, 157, 143, 0.5);
        }

        .scenario-btn.active {
            background: rgba(233, 196, 106, 0.5);
            color: #e9c46a;
        }

        .vehicle-status {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .status-label {
            font-size: 0.8rem;
            color: #a0a0a0;
        }

        .status-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 5px;
        }

        .speedometer {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto;
        }

        .speed-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: bold;
            color: #e9c46a;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .control-btn {
            padding: 12px;
            background: rgba(42, 157, 143, 0.5);
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: rgba(42, 157, 143, 0.7);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .control-btn.warning {
            background: rgba(230, 57, 70, 0.5);
        }

        .control-btn.warning:hover {
            background: rgba(230, 57, 70, 0.7);
        }

        .control-btn.success {
            background: rgba(56, 176, 0, 0.5);
        }

        .control-btn.success:hover {
            background: rgba(56, 176, 0, 0.7);
        }

        .results {
            display: none;
            margin-top: 20px;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .score-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            width: 45%;
            text-align: center;
        }

        .score-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #e9c46a;
        }

        .score-value {
            font-size: 2.5rem;
            font-weight: bold;
        }

        .rage-score {
            color: #e63946;
        }

        .skill-score {
            color: #2a9d8f;
        }

        .score-bar {
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-top: 10px;
            overflow: hidden;
        }

        .score-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }

        .rage-fill {
            background: #e63946;
        }

        .skill-fill {
            background: #2a9d8f;
        }

        .evaluation {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 10px;
            color: #e9c46a;
        }

        .key-instructions {
            margin-top: 20px;
            text-align: center;
            color: #a0a0a0;
            font-size: 0.9rem;
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 900px) {
            .game-area {
                flex-direction: column;
            }
            
            .scenario-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é§•é§›æ¨¡æ“¬éŠæˆ²</h1>
            <p>é«”é©—çœŸå¯¦é§•é§›æ„Ÿå—ï¼Œæ¸¬è©¦æ‚¨çš„é§•é§›æŠ€è¡“èˆ‡æƒ…ç·’æ§åˆ¶</p>
        </header>

        <div class="game-area">
            <div class="game-canvas-container">
                <canvas id="gameCanvas"></canvas>
            </div>

            <div class="game-controls">
                <div class="panel vehicle-selection">
                    <h2>é¸æ“‡è»Šè¼›</h2>
                    <div class="vehicle-option selected" data-vehicle="city_car">
                        <div class="vehicle-icon">ğŸš—</div>
                        <div>
                            <div>åŸå¸‚å°è»Š</div>
                            <div class="vehicle-specs">1200cc Â· ç©©å®šæ€§é«˜</div>
                        </div>
                    </div>
                    <div class="vehicle-option" data-vehicle="sedan">
                        <div class="vehicle-icon">ğŸš™</div>
                        <div>
                            <div>å®¶åº­è½è»Š</div>
                            <div class="vehicle-specs">1800cc Â· å‡è¡¡æ€§èƒ½</div>
                        </div>
                    </div>
                    <div class="vehicle-option" data-vehicle="sports_car">
                        <div class="vehicle-icon">ğŸï¸</div>
                        <div>
                            <div>é‹å‹•è·‘è»Š</div>
                            <div class="vehicle-specs">2500cc Â· åŠ é€Ÿå¿«</div>
                        </div>
                    </div>
                </div>

                <div class="panel scenario-selection">
                    <h2>é¸æ“‡æƒ…å¢ƒ</h2>
                    <button class="scenario-btn active" data-scenario="city_traffic">å¸‚å€äº¤é€š</button>
                    <button class="scenario-btn" data-scenario="mountain_road">å±±å€é“è·¯</button>
                    <button class="scenario-btn" data-scenario="highway">é«˜é€Ÿå…¬è·¯</button>
                </div>

                <div class="panel vehicle-status">
                    <h2>è»Šè¼›ç‹€æ…‹</h2>
                    <div class="status-item">
                        <div class="status-label">é€Ÿåº¦</div>
                        <div class="speedometer">
                            <div class="speed-value">0</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">æª”ä½</div>
                        <div class="status-value" id="gear">D</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">æ–¹å‘ç‡ˆ</div>
                        <div class="status-value" id="turn-signal">é—œé–‰</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">é‹å‹•æ¨¡å¼</div>
                        <div class="status-value" id="sport-mode">é—œé–‰</div>
                    </div>
                </div>

                <div class="panel controls">
                    <h2>æ“ä½œæ§åˆ¶</h2>
                    <button class="control-btn" id="accelerate-btn">åŠ é€Ÿ</button>
                    <button class="control-btn warning" id="brake-btn">ç…è»Š</button>
                    <button class="control-btn" id="left-turn-btn">å·¦è½‰</button>
                    <button class="control-btn" id="right-turn-btn">å³è½‰</button>
                    <button class="control-btn" id="left-signal-btn">å·¦æ–¹å‘ç‡ˆ</button>
                    <button class="control-btn" id="right-signal-btn">å³æ–¹å‘ç‡ˆ</button>
                    <button class="control-btn" id="sport-mode-btn">é‹å‹•æ¨¡å¼</button>
                    <button class="control-btn success" id="start-btn">é–‹å§‹é§•é§›</button>
                </div>
            </div>
        </div>

        <div class="panel results" id="results-panel">
            <h2>é§•é§›è©•åˆ†çµæœ</h2>
            <div class="score-display">
                <div class="score-card">
                    <div class="score-title">è·¯æ€’ç—‡ç¨‹åº¦</div>
                    <div class="score-value rage-score" id="rage-score">0</div>
                    <div class="score-bar">
                        <div class="score-fill rage-fill" id="rage-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="score-card">
                    <div class="score-title">é§•é§›æŠ€è¡“</div>
                    <div class="score-value skill-score" id="skill-score">0</div>
                    <div class="score-bar">
                        <div class="score-fill skill-fill" id="skill-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            <div class="evaluation" id="evaluation-text"></div>
        </div>

        <div class="key-instructions">
            <p>éµç›¤æ“ä½œï¼šâ†‘åŠ é€Ÿ â†“ç…è»Š â†å·¦è½‰ â†’å³è½‰ Qå·¦æ–¹å‘ç‡ˆ Eå³æ–¹å‘ç‡ˆ Sé‹å‹•æ¨¡å¼</p>
        </div>
    </div>

    <script>
        // éŠæˆ²ä¸»é¡
        class DrivingGame {
            constructor() {
                // è»Šè¼›é¸æ“‡
                this.vehicles = {
                    "city_car": {"name": "åŸå¸‚å°è»Š", "cc": 1200, "stability": 0.8},
                    "sedan": {"name": "å®¶åº­è½è»Š", "cc": 1800, "stability": 0.9},
                    "sports_car": {"name": "é‹å‹•è·‘è»Š", "cc": 2500, "stability": 0.7}
                };

                // éŠæˆ²ç‹€æ…‹
                this.currentVehicle = this.vehicles["city_car"];
                this.speed = 0;
                this.gear = "D";  // D:å‰é€², S:é‹å‹•, R:å€’è»Š
                this.turn_signal = "none";  // left, right, none
                this.sport_mode = false;
                this.position = { x: 0, y: 0 };
                this.direction = 0; // è§’åº¦
                this.roadOffset = 0; // é“è·¯åç§»é‡ï¼Œç”¨æ–¼å‹•ç•«

                // è©•åˆ†æ•¸æ“š
                this.collisions = 0;
                this.dangerous_actions = 0;
                this.smooth_actions = 0;
                this.aggressive_actions = 0;

                // æƒ…å¢ƒåƒæ•¸
                this.current_scenario = "city_traffic";
                this.gameActive = false;
                this.gameTime = 0;
                this.maxGameTime = 60; // 60ç§’éŠæˆ²æ™‚é–“

                // Canvas ç›¸é—œ
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.resizeCanvas();
                window.addEventListener('resize', () => this.resizeCanvas());

                // åˆå§‹åŒ–äº‹ä»¶ç›£è½
                this.initEventListeners();
                
                // éŠæˆ²å¾ªç’°
                this.lastTime = 0;
                this.gameLoop(0);
            }

            resizeCanvas() {
                this.canvas.width = this.canvas.offsetWidth;
                this.canvas.height = this.canvas.offsetHeight;
                this.drawScene();
            }

            initEventListeners() {
                // è»Šè¼›é¸æ“‡
                document.querySelectorAll('.vehicle-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.vehicle-option').forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        this.selectVehicle(option.dataset.vehicle);
                    });
                });

                // æƒ…å¢ƒé¸æ“‡
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.scenario-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.selectScenario(btn.dataset.scenario);
                    });
                });

                // æ§åˆ¶æŒ‰éˆ•
                document.getElementById('accelerate-btn').addEventListener('click', () => this.accelerate(0.5));
                document.getElementById('brake-btn').addEventListener('click', () => this.brake(0.5));
                document.getElementById('left-turn-btn').addEventListener('click', () => this.turn('left', 30));
                document.getElementById('right-turn-btn').addEventListener('click', () => this.turn('right', 30));
                document.getElementById('left-signal-btn').addEventListener('click', () => this.toggleTurnSignal('left'));
                document.getElementById('right-signal-btn').addEventListener('click', () => this.toggleTurnSignal('right'));
                document.getElementById('sport-mode-btn').addEventListener('click', () => this.toggleSportMode());
                document.getElementById('start-btn').addEventListener('click', () => this.startScenario());

                // éµç›¤æ§åˆ¶
                document.addEventListener('keydown', (e) => this.handleKeyDown(e));
                document.addEventListener('keyup', (e) => this.handleKeyUp(e));
            }

            handleKeyDown(e) {
                if (!this.gameActive) return;

                switch(e.key) {
                    case 'ArrowUp':
                        this.accelerate(0.7);
                        break;
                    case 'ArrowDown':
                        this.brake(0.7);
                        break;
                    case 'ArrowLeft':
                        this.turn('left', 25);
                        break;
                    case 'ArrowRight':
                        this.turn('right', 25);
                        break;
                    case 'q':
                    case 'Q':
                        this.toggleTurnSignal('left');
                        break;
                    case 'e':
                    case 'E':
                        this.toggleTurnSignal('right');
                        break;
                    case 's':
                    case 'S':
                        this.toggleSportMode();
                        break;
                }
            }

            handleKeyUp(e) {
                // å¯ä»¥å¯¦ç¾æŒçºŒæŒ‰éµé‡‹æ”¾å¾Œçš„é‚è¼¯
            }

            selectVehicle(vehicle_type) {
                if (vehicle_type in this.vehicles) {
                    this.currentVehicle = this.vehicles[vehicle_type];
                    console.log(`å·²é¸æ“‡: ${this.currentVehicle['name']}`);
                } else {
                    console.log("ç„¡æ•ˆçš„è»Šè¼›é¸æ“‡");
                }
            }

            selectScenario(scenario_name) {
                this.current_scenario = scenario_name;
                console.log(`é¸æ“‡ ${scenario_name} æƒ…å¢ƒ`);
                this.drawScene();
            }

            startScenario() {
                this.gameActive = true;
                this.gameTime = 0;
                this.resetGameState();
                document.getElementById('start-btn').textContent = "é§•é§›ä¸­...";
                document.getElementById('start-btn').disabled = true;
                document.getElementById('results-panel').style.display = 'none';
                
                // æ ¹æ“šæƒ…å¢ƒè¨­ç½®åˆå§‹ç‹€æ…‹
                if (this.current_scenario === "city_traffic") {
                    this.speed = 20;
                } else if (this.current_scenario === "mountain_road") {
                    this.speed = 30;
                } else if (this.current_scenario === "highway") {
                    this.speed = 60;
                }
                
                this.updateUI();
            }

            resetGameState() {
                this.speed = 0;
                this.gear = "D";
                this.turn_signal = "none";
                this.sport_mode = false;
                this.collisions = 0;
                this.dangerous_actions = 0;
                this.smooth_actions = 0;
                this.aggressive_actions = 0;
                this.position = { x: 0, y: 0 };
                this.direction = 0;
                this.roadOffset = 0;
            }

            accelerate(intensity=1.0) {
                if (!this.gameActive) return;
                
                if (this.gear !== "D" && this.gear !== "S") {
                    console.log("ç•¶å‰æª”ä½ç„¡æ³•åŠ é€Ÿ");
                    return;
                }

                // åŸºç¤åŠ é€Ÿè¨ˆç®—
                let base_accel = 0.1;
                if (this.sport_mode) {
                    base_accel *= 1.3;
                }

                let speed_increase = base_accel * intensity * 10;
                this.speed += speed_increase;

                // è¨˜éŒ„æ“ä½œé¡å‹
                if (intensity > 0.7) {
                    this.aggressive_actions += 1;
                    console.log("æ¿€çƒˆåŠ é€Ÿ");
                } else {
                    this.smooth_actions += 1;
                }

                // æƒ…å¢ƒç‰¹å®šæª¢æŸ¥
                this._check_scenario_speed();
                
                this.updateUI();
            }

            brake(intensity=1.0) {
                if (!this.gameActive) return;
                
                let speed_decrease = 15 * intensity;
                this.speed = Math.max(0, this.speed - speed_decrease);

                // æ€¥ç…è»Šæª¢æ¸¬
                if (intensity > 0.8 && this.speed > 30) {
                    this.dangerous_actions += 1;
                    console.log("æ³¨æ„ï¼æ€¥ç…è»Šè­¦å‘Š");
                }
                
                this.updateUI();
            }

            turn(direction, angle) {
                if (!this.gameActive) return;
                
                // è¨ˆç®—å®‰å…¨è½‰å‘è§’åº¦
                let safe_angle = this._calculate_safe_turn_angle();

                if (angle > safe_angle * 0.8) {
                    this.dangerous_actions += 1;
                    console.log("å±éšªè½‰å‘");
                }

                // æª¢æŸ¥æ–¹å‘ç‡ˆä½¿ç”¨
                if ((direction === "left" && this.turn_signal !== "left") || 
                    (direction === "right" && this.turn_signal !== "right")) {
                    this.dangerous_actions += 1;
                    console.log("è½‰å‘æœªæ‰“æ–¹å‘ç‡ˆ");
                }

                // æ›´æ–°æ–¹å‘
                if (direction === "left") {
                    this.direction -= angle * 0.1;
                } else {
                    this.direction += angle * 0.1;
                }
                
                this.updateUI();
            }

            _calculate_safe_turn_angle() {
                let base_angle = 45;
                let speed_factor = 1 - (this.speed / 100) * 0.5;
                let vehicle_factor = this.currentVehicle["stability"];
                return base_angle * speed_factor * vehicle_factor;
            }

            shift_gear(new_gear) {
                if (!this.gameActive) return;
                
                // å±éšªæ›æª”æª¢æ¸¬
                if (this.speed > 20 && new_gear === "R") {
                    this.dangerous_actions += 2;
                    console.log("è­¦å‘Šï¼é«˜é€Ÿæ™‚æ›å€’æª”å¾ˆå±éšª");
                } else {
                    this.smooth_actions += 1;
                }

                this.gear = new_gear;
                this.updateUI();
            }

            toggleTurnSignal(signal) {
                if (!this.gameActive) return;
                
                if (this.turn_signal === signal) {
                    this.turn_signal = "none";
                } else {
                    this.turn_signal = signal;
                }
                this.updateUI();
            }

            toggleSportMode() {
                if (!this.gameActive) return;
                
                this.sport_mode = !this.sport_mode;
                let status = this.sport_mode ? "é–‹å•Ÿ" : "é—œé–‰";
                console.log(`é‹å‹•æ¨¡å¼ ${status}`);
                this.updateUI();
            }

            _check_scenario_speed() {
                if (!this.current_scenario) {
                    return;
                }

                if (this.current_scenario === "city_traffic" && this.speed > 60) {
                    this.dangerous_actions += 1;
                    console.log("æ³¨æ„ï¼å¸‚å€è¶…é€Ÿ");
                } else if (this.current_scenario === "mountain_road" && this.speed > 80) {
                    this.dangerous_actions += 1;
                    console.log("æ³¨æ„ï¼å±±å€é“è·¯è¶…é€Ÿ");
                } else if (this.current_scenario === "highway" && this.speed > 110) {
                    this.dangerous_actions += 1;
                    console.log("æ³¨æ„ï¼é«˜é€Ÿå…¬è·¯è¶…é€Ÿ");
                }
            }

            checkCollision() {
                let collision_chance = 0.01;

                // é€Ÿåº¦å’Œå±éšªæ“ä½œå¢åŠ ç¢°æ’æ©Ÿç‡
                let speed_factor = this.speed / 100;
                let danger_factor = this.dangerous_actions * 0.02;
                collision_chance += speed_factor * 0.05 + danger_factor;

                // ç°¡åŒ–éš¨æ©Ÿç¢°æ’æª¢æ¸¬
                if (Math.random() < collision_chance) {
                    this.collisions += 1;
                    console.log("ç™¼ç”Ÿç¢°æ’ï¼");
                    return true;
                }
                return false;
            }

            calculateScores() {
                // è·¯æ€’ç—‡ç¨‹åº¦ (0-100ï¼Œè¶Šé«˜è¶Šåš´é‡)
                let rage_score = (
                    this.collisions * 25 +
                    this.dangerous_actions * 8 +
                    this.aggressive_actions * 3
                );
                let road_rage_level = Math.min(100, rage_score);

                // é§•é§›æŠ€è¡“ (0-100ï¼Œè¶Šé«˜è¶Šå¥½)
                let skill_score = 50;  // åŸºç¤åˆ†
                skill_score += this.smooth_actions * 0.5;
                skill_score -= this.dangerous_actions * 3;
                skill_score -= this.collisions * 15;
                let driving_skill = Math.max(0, Math.min(100, skill_score));

                return { road_rage_level, driving_skill };
            }

            finishScenario() {
                this.gameActive = false;
                document.getElementById('start-btn').textContent = "é–‹å§‹é§•é§›";
                document.getElementById('start-btn').disabled = false;
                
                let scores = this.calculateScores();
                
                // é¡¯ç¤ºçµæœ
                document.getElementById('results-panel').style.display = 'block';
                document.getElementById('rage-score').textContent = Math.round(scores.road_rage_level);
                document.getElementById('skill-score').textContent = Math.round(scores.driving_skill);
                
                // å‹•ç•«é¡¯ç¤ºé€²åº¦æ¢
                setTimeout(() => {
                    document.getElementById('rage-bar').style.width = `${scores.road_rage_level}%`;
                    document.getElementById('skill-bar').style.width = `${scores.driving_skill}%`;
                }, 100);
                
                // çµ¦å‡ºè©•åƒ¹
                let evaluationText = "";
                if (scores.road_rage_level < 30) {
                    evaluationText += "å†·éœçš„å®‰å…¨é§•é§›è€…";
                } else if (scores.road_rage_level < 60) {
                    evaluationText += "æ™®é€šé§•é§›è€…";
                } else {
                    evaluationText += "éœ€è¦æ³¨æ„è·¯æ€’å‚¾å‘";
                }
                
                evaluationText += " | ";
                
                if (scores.driving_skill > 80) {
                    evaluationText += "å„ªç§€é§•é§›æŠ€è¡“";
                } else if (scores.driving_skill > 60) {
                    evaluationText += "è‰¯å¥½é§•é§›æŠ€è¡“";
                } else {
                    evaluationText += "éœ€è¦æå‡é§•é§›æŠ€è¡“";
                }
                
                document.getElementById('evaluation-text').textContent = evaluationText;
                
                return scores;
            }

            updateUI() {
                // æ›´æ–°é€Ÿåº¦
                document.querySelector('.speed-value').textContent = Math.round(this.speed);
                
                // æ›´æ–°æª”ä½
                document.getElementById('gear').textContent = this.gear;
                
                // æ›´æ–°æ–¹å‘ç‡ˆ
                let turnSignalText = "é—œé–‰";
                if (this.turn_signal === "left") turnSignalText = "å·¦è½‰";
                if (this.turn_signal === "right") turnSignalText = "å³è½‰";
                document.getElementById('turn-signal').textContent = turnSignalText;
                
                // æ›´æ–°é‹å‹•æ¨¡å¼
                document.getElementById('sport-mode').textContent = this.sport_mode ? "é–‹å•Ÿ" : "é—œé–‰";
            }

            drawScene() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // æ¸…é™¤ç•«å¸ƒ
                ctx.clearRect(0, 0, width, height);
                
                // æ ¹æ“šæƒ…å¢ƒç¹ªè£½èƒŒæ™¯
                if (this.current_scenario === "city_traffic") {
                    this.drawCityScene();
                } else if (this.current_scenario === "mountain_road") {
                    this.drawMountainScene();
                } else if (this.current_scenario === "highway") {
                    this.drawHighwayScene();
                }
                
                // ç¹ªè£½è»Šè¼›
                this.drawVehicle();
                
                // ç¹ªè£½éŠæˆ²ç‹€æ…‹ä¿¡æ¯
                this.drawGameInfo();
            }

            drawCityScene() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // ç¹ªè£½å¤©ç©º
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, width, height/2);
                
                // ç¹ªè£½é“è·¯
                ctx.fillStyle = '#333';
                ctx.fillRect(0, height/2 - 50, width, 100);
                
                // ç¹ªè£½é“è·¯æ¨™ç·š
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.setLineDash([20, 20]);
                ctx.beginPath();
                ctx.moveTo(0, height/2);
                ctx.lineTo(width, height/2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç¹ªè£½å»ºç¯‰ç‰©
                ctx.fillStyle = '#555';
                for (let i = 0; i < 5; i++) {
                    ctx.fillRect(i * 150 + 50, height/2 - 150, 80, 100);
                }
                
                // ç¹ªè£½äº¤é€šç‡ˆ
                ctx.fillStyle = '#222';
                ctx.fillRect(width/2 - 10, height/2 - 120, 20, 40);
                ctx.fillStyle = this.speed > 60 ? '#f00' : '#0a0';
                ctx.beginPath();
                ctx.arc(width/2, height/2 - 110, 8, 0, Math.PI * 2);
                ctx.fill();
            }

            drawMountainScene() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // ç¹ªè£½å±±è„ˆèƒŒæ™¯
                ctx.fillStyle = '#1e3a5f';
                ctx.fillRect(0, 0, width, height);
                
                // ç¹ªè£½é“è·¯
                ctx.fillStyle = '#444';
                ctx.beginPath();
                ctx.moveTo(0, height/2 + 100);
                ctx.bezierCurveTo(width/3, height/2 - 50, width*2/3, height/2 + 150, width, height/2);
                ctx.lineTo(width, height);
                ctx.lineTo(0, height);
                ctx.closePath();
                ctx.fill();
                
                // ç¹ªè£½é“è·¯æ¨™ç·š
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.setLineDash([20, 20]);
                ctx.beginPath();
                ctx.moveTo(0, height/2 + 100);
                ctx.bezierCurveTo(width/3, height/2 - 50, width*2/3, height/2 + 150, width, height/2);
                ctx.stroke();
                ctx.setLineDash([]);
                
                // ç¹ªè£½æ¨¹æœ¨
                ctx.fillStyle = '#2d6a4f';
                for (let i = 0; i < 8; i++) {
                    let x = i * 100 + 30;
                    let y = height/2 - 50 + Math.sin(i) * 30;
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                    ctx.lineTo(x - 20, y + 40);
                    ctx.lineTo(x + 20, y + 40);
                    ctx.closePath();
                    ctx.fill();
                }
            }

            drawHighwayScene() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // ç¹ªè£½å¤©ç©º
                ctx.fillStyle = '#87CEEB';
                ctx.fillRect(0, 0, width, height/2);
                
                // ç¹ªè£½é«˜é€Ÿå…¬è·¯
                ctx.fillStyle = '#444';
                ctx.fillRect(0, height/2 - 80, width, 160);
                
                // ç¹ªè£½è»Šé“æ¨™ç·š
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.setLineDash([30, 30]);
                
                // ä¸­é–“ç·š
                ctx.beginPath();
                ctx.moveTo(0, height/2);
                ctx.lineTo(width, height/2);
                ctx.stroke();
                
                // è»Šé“ç·š
                ctx.beginPath();
                ctx.moveTo(0, height/2 - 40);
                ctx.lineTo(width, height/2 - 40);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(0, height/2 + 40);
                ctx.lineTo(width, height/2 + 40);
                ctx.stroke();
                
                ctx.setLineDash([]);
                
                // ç¹ªè£½å…¶ä»–è»Šè¼›
                ctx.fillStyle = '#e63946';
                ctx.fillRect(width/2 + 100, height/2 - 60, 60, 30);
                
                ctx.fillStyle = '#1d3557';
                ctx.fillRect(width/2 - 200, height/2 + 30, 70, 35);
            }

            drawVehicle() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                const height = this.canvas.height;
                
                // ç¹ªè£½ç©å®¶è»Šè¼›
                ctx.fillStyle = '#2a9d8f';
                ctx.fillRect(width/2 - 30, height/2 - 15, 60, 30);
                
                // ç¹ªè£½è»Šè¼›ç´°ç¯€
                ctx.fillStyle = '#1d3557';
                ctx.fillRect(width/2 - 25, height/2 - 10, 50, 20);
                
                // ç¹ªè£½è»Šè¼ª
                ctx.fillStyle = '#222';
                ctx.fillRect(width/2 - 35, height/2 - 20, 10, 10);
                ctx.fillRect(width/2 + 25, height/2 - 20, 10, 10);
                ctx.fillRect(width/2 - 35, height/2 + 10, 10, 10);
                ctx.fillRect(width/2 + 25, height/2 + 10, 10, 10);
                
                // ç¹ªè£½æ–¹å‘ç‡ˆ
                if (this.turn_signal === "left") {
                    ctx.fillStyle = '#ff9e00';
                    ctx.beginPath();
                    ctx.arc(width/2 - 35, height/2, 5, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.turn_signal === "right") {
                    ctx.fillStyle = '#ff9e00';
                    ctx.beginPath();
                    ctx.arc(width/2 + 35, height/2, 5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            drawGameInfo() {
                const ctx = this.ctx;
                const width = this.canvas.width;
                
                // ç¹ªè£½æƒ…å¢ƒåç¨±
                ctx.fillStyle = '#e9c46a';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText(`æƒ…å¢ƒ: ${this.getScenarioName()}`, 20, 30);
                
                // ç¹ªè£½è»Šè¼›åç¨±
                ctx.fillStyle = '#fff';
                ctx.font = '16px Arial';
                ctx.fillText(`è»Šè¼›: ${this.currentVehicle.name}`, 20, 60);
                
                // å¦‚æœéŠæˆ²é€²è¡Œä¸­ï¼Œç¹ªè£½å‰©é¤˜æ™‚é–“
                if (this.gameActive) {
                    ctx.fillStyle = '#fff';
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText(`å‰©é¤˜æ™‚é–“: ${Math.max(0, Math.ceil(this.maxGameTime - this.gameTime))}ç§’`, width - 20, 30);
                }
            }

            getScenarioName() {
                switch(this.current_scenario) {
                    case "city_traffic": return "å¸‚å€äº¤é€š";
                    case "mountain_road": return "å±±å€é“è·¯";
                    case "highway": return "é«˜é€Ÿå…¬è·¯";
                    default: return "æœªçŸ¥æƒ…å¢ƒ";
                }
            }

            gameLoop(timestamp) {
                const deltaTime = timestamp - this.lastTime;
                this.lastTime = timestamp;
                
                if (this.gameActive) {
                    // æ›´æ–°éŠæˆ²æ™‚é–“
                    this.gameTime += deltaTime / 1000;
                    
                    // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ
                    if (this.gameTime >= this.maxGameTime) {
                        this.finishScenario();
                    }
                    
                    // éš¨æ©Ÿç¢°æ’æª¢æ¸¬
                    if (Math.random() < 0.01) {
                        this.checkCollision();
                    }
                    
                    // æ›´æ–°é“è·¯åç§»ï¼ˆæ¨¡æ“¬ç§»å‹•ï¼‰
                    this.roadOffset = (this.roadOffset + this.speed * 0.01) % 100;
                }
                
                this.drawScene();
                requestAnimationFrame((ts) => this.gameLoop(ts));
            }
        }

        // åˆå§‹åŒ–éŠæˆ²
        document.addEventListener('DOMContentLoaded', () => {
            const game = new DrivingGame();
        });
    </script>
</body>
</html>
