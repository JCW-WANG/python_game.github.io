<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ é›»å½±é…æ¨‚çŒœè¬å¤§è³½</title>
    <style>
        :root {
            --primary-color: #f5c518; /* IMDB Yellow */
            --bg-color: #121212;
            --card-bg: #1f1f1f;
            --text-color: #ffffff;
            --p1-color: #ff4d4d; /* Player 1 Red */
            --p2-color: #4d79ff; /* Player 2 Blue */
            --accent-color: #00e676;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /*Header & Scoreboard*/
        header {
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 100%);
            padding: 20px;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(245, 197, 24, 0.5);
            margin-bottom: 15px;
        }

        .scoreboard {
            display: flex;
            justify-content: center;
            gap: 40px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .score-box {
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 10px;
            min-width: 120px;
            border: 2px solid transparent;
            transition: transform 0.2s;
        }

        .p1-score { border-color: var(--p1-color); color: var(--p1-color); }
        .p2-score { border-color: var(--p2-color); color: var(--p2-color); }

        /* Main Game Area */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        /* Status Indicator */
        .status-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
            min-height: 2em;
            text-align: center;
            color: #ddd;
        }

        /* Visual Elements */
        .visualizer {
            width: 100%;
            max-width: 600px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 30px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .visualizer.active { opacity: 1; }

        .bar {
            width: 8px;
            height: 20px;
            background-color: var(--primary-color);
            animation: bounce 1s infinite ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { height: 20px; }
            50% { height: 50px; }
        }

        /* Controls / Buzzer Buttons */
        .controls-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            width: 100%;
            max-width: 600px;
        }

        .btn {
            border: none;
            padding: 20px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: none; /* Hidden by default, shown via JS */
        }

        .btn:active { transform: scale(0.95); }

        .btn-p1 { background-color: var(--p1-color); color: white; }
        .btn-p2 { background-color: var(--p2-color); color: white; }
        .btn-main { 
            grid-column: span 2; 
            background-color: var(--primary-color); 
            color: black; 
        }
        .btn-judge {
            grid-column: span 2;
            display: flex;
            gap: 10px;
            background: transparent;
            box-shadow: none;
            padding: 0;
        }
        .btn-yes { flex: 1; background-color: var(--accent-color); color: black; }
        .btn-no { flex: 1; background-color: #ff4444; color: white; }

        /* Result Card */
        .movie-card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            width: 100%;
            text-align: left;
            display: none; /* Hidden by default */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .movie-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
        }

        .movie-desc {
            font-size: 1rem;
            line-height: 1.6;
            color: #ccc;
            white-space: pre-wrap; /* Preserve line breaks from data */
        }

        .citation {
            font-size: 0.8rem;
            color: #666;
            margin-top: 15px;
            font-style: italic;
        }

        /* Keyboard Hints */
        .kb-hint {
            display: block;
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* RWD Adjustments */
        @media (max-width: 768px) {
            h1 { font-size: 1.5rem; }
            .kb-hint { display: none; } /* Hide keyboard hints on mobile */
            .controls-area { grid-template-columns: 1fr 1fr; }
            .btn { padding: 30px 10px; } /* Larger touch area */
        }
    </style>
</head>
<body>

    <header>
        <h1>ğŸ¬ é›»å½±é…æ¨‚çŒœè¬</h1>
        <div class="scoreboard">
            <div class="score-box p1-score">
                <div>P1 (ç´…)</div>
                <div id="score-p1-display">0</div>
            </div>
            <div class="score-box p2-score">
                <div>P2 (è—)</div>
                <div id="score-p2-display">0</div>
            </div>
        </div>
    </header>

    <main>
        <div id="status-display" class="status-text">æº–å‚™å¥½äº†å—ï¼Ÿ</div>

        <div id="visualizer" class="visualizer">
            <div class="bar" style="animation-delay: 0s"></div>
            <div class="bar" style="animation-delay: 0.2s"></div>
            <div class="bar" style="animation-delay: 0.4s"></div>
            <div class="bar" style="animation-delay: 0.1s"></div>
            <div class="bar" style="animation-delay: 0.5s"></div>
            <div class="bar" style="animation-delay: 0.3s"></div>
        </div>

        <div id="result-card" class="movie-card">
            <h2 class="movie-title" id="card-title">é›»å½±æ¨™é¡Œ</h2>
            <div class="movie-desc" id="card-desc">æè¿°å…§å®¹...</div>
            <div class="citation" id="card-cite"></div>
        </div>

        <div class="controls-area">
            <button id="btn-start" class="btn btn-main" style="display: block;">
                æ’­æ”¾éŸ³æ¨‚ (ç©ºç™½éµ)
            </button>

            <button id="btn-p1" class="btn btn-p1">
                P1 æ¶ç­” <span class="kb-hint">(æŒ‰ A)</span>
            </button>
            <button id="btn-p2" class="btn btn-p2">
                P2 æ¶ç­” <span class="kb-hint">(æŒ‰ L)</span>
            </button>

            <div id="judge-controls" class="btn btn-judge" style="display: none;">
                <button id="btn-correct" class="btn btn-yes">â­• ç­”å° (Y)</button>
                <button id="btn-wrong" class="btn btn-no">âŒ ç­”éŒ¯ (N)</button>
            </div>

            <button id="btn-next" class="btn btn-main">
                ä¸‹ä¸€é¡Œ (ç©ºç™½éµ)
            </button>
        </div>
    </main>

    <script>
        // --- 1. è³‡æ–™åº« (å¾ PDF è½‰æ›) ---
        // æ³¨æ„ï¼šéŸ³è¨Šæª”æ¡ˆè·¯å¾‘ (file) é è¨­ç‚º 'assets/music/xxx.mp3'ã€‚
        // ä½ éœ€è¦åœ¨ GitHub å„²å­˜åº«å»ºç«‹å°æ‡‰è³‡æ–™å¤¾ä¸¦ä¸Šå‚³æª”æ¡ˆã€‚
        const MOVIES = [
            {
                id: 1,
                title: "The Godfather (æ•™çˆ¶, 1972)",
                file: "godfather.mp3",
                [cite_start]desc: "æ³•è˜­è¥¿æ–¯Â·æŸ¯æ³¢æ‹‰åŸ·å°ï¼Œè¬›è¿°ç´ç´„é»‘æ‰‹é»¨æŸ¯é‡Œæ˜‚å®¶æ—çš„æ•…äº‹ã€‚æ¢è¨æ¬ŠåŠ›ã€å®¶åº­å€«ç†èˆ‡ç§»æ°‘æ™æ‰ã€‚å°¼è«¾Â·ç¾…å¡”çš„é…æ¨‚å“€å‚·è€Œå„ªç¾ [cite: 1]ã€‚",
                cite: ""
            },
            {
                id: 2,
                title: "Star Wars (æ˜Ÿéš›å¤§æˆ°, 1977)",
                file: "starwars.mp3",
                [cite_start]desc: "å–¬æ²»Â·ç›§å¡æ–¯åŸ·å°çš„å¤ªç©ºæ­ŒåŠ‡ã€‚è·¯å…‹Â·å¤©è¡Œè€…å°æŠ—éŠ€æ²³å¸åœ‹ã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„äº¤éŸ¿æ¨‚é…æ¨‚æ°£å‹¢ç£…ç¤´ [cite: 2]ã€‚",
                cite: ""
            },
            {
                id: 3,
                title: "Casablanca (åŒ—éè«œå½±, 1942)",
                file: "casablanca.mp3",
                [cite_start]desc: "äºŒæˆ°æ™‚æœŸæ‘©æ´›å“¥çš„æ„›æƒ…ç¶“å…¸ã€‚ç‘å…‹åœ¨æ„›æƒ…èˆ‡æ­£ç¾©é–“æŠ‰æ“‡ã€‚ã€ŒAs Time Goes Byã€è²«ç©¿å…¨ç‰‡ï¼Œæˆç‚ºæ„›æƒ…è±¡å¾µ [cite: 3]ã€‚",
                cite: ""
            },
            {
                id: 4,
                title: "Gone with the Wind (äº‚ä¸–ä½³äºº, 1939)",
                file: "gonewiththewind.mp3",
                [cite_start]desc: "å—åŒ—æˆ°çˆ­å²è©©å·¨ä½œï¼Œè²»é›¯Â·éº—é£¾æ¼”éƒæ€å˜‰ã€‚å±•ç¾å—æ–¹ç¤¾æœƒå´©æ½°èˆ‡é‡å»ºã€‚ã€Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ã€æˆç‚ºåè¨€ [cite: 4]ã€‚",
                cite: ""
            },
            {
                id: 5,
                title: "The Wizard of Oz (ç¶ é‡ä»™è¹¤, 1939)",
                file: "wizardofoz.mp3",
                [cite_start]desc: "æ¡ƒæ¨‚çµ²è¢«é¾æ²é¢¨æ²åˆ°å¥§èŒ²åœ‹çš„å¥‡å¹»æ—…ç¨‹ã€‚ã€ŒOver the Rainbowã€æˆç‚ºå½±å²æœ€å‰å¤§æ­Œæ›²ä¹‹ä¸€ [cite: 5]ã€‚",
                cite: ""
            },
            {
                id: 6,
                title: "Titanic (éµé”å°¼è™Ÿ, 1997)",
                file: "titanic.mp3",
                [cite_start]desc: "è©¹å§†æ–¯Â·å¡éº¥éš†åŸ·å°çš„ç½é›£æ„›æƒ…å²è©©ã€‚å¸­ç³Â·ç‹„ç¿çš„ä¸»é¡Œæ›²ã€ŒMy Heart Will Go Onã€é¢¨é¡å…¨çƒ [cite: 6]ã€‚",
                cite: ""
            },
            {
                id: 7,
                title: "Jaws (å¤§ç™½é¯Š, 1975)",
                file: "jaws.mp3",
                [cite_start]desc: "å²è’‚èŠ¬Â·å²åŒ¹æŸåŸ·å°ã€‚ç´„ç¿°Â·å¨å»‰æ–¯çš„å…©éŸ³ç¬¦ä¸»é¡Œæ›²è£½é€ æ¥µå¤§ç·Šå¼µæ„Ÿã€‚é–‹å‰µæš‘æœŸå¤§ç‰‡å•†æ¥­æ¨¡å¼ [cite: 7]ã€‚",
                cite: ""
            },
            {
                id: 8,
                title: "Rocky (æ´›åŸº, 1976)",
                file: "rocky.mp3",
                [cite_start]desc: "å²ç‰¹é¾è‡ªç·¨è‡ªæ¼”çš„å‹µå¿—æ‹³æ“Šç‰‡ã€‚ã€ŒGonna Fly Nowã€é…æ¨‚æ­é…è²»åŸç¾è¡“é¤¨éšæ¢¯è·‘å‹•å ´æ™¯ç‚ºç¶“å…¸ [cite: 8]ã€‚",
                cite: ""
            },
            {
                id: 9,
                title: "E.T. the Extra-Terrestrial (E.T.å¤–æ˜Ÿäºº, 1982)",
                file: "et.mp3",
                [cite_start]desc: "80å¹´ä»£ä»£è¡¨æ€§å®¶åº­é›»å½±ã€‚ç´„ç¿°Â·å¨å»‰æ–¯çš„é…æ¨‚å……æ»¿ç«¥çœŸã€‚å­©å­å€‘é¨è»Šé£›è¶Šæœˆäº®çš„ç•«é¢æ˜¯å½±å²ç¶“å…¸ [cite: 9]ã€‚",
                cite: ""
            },
            {
                id: 10,
                title: "Raiders of the Lost Ark (æ³•æ«ƒå¥‡å…µ, 1981)",
                file: "raiders.mp3",
                [cite_start]desc: "å°ç¬¬å®‰ç´Â·ç“Šæ–¯ç³»åˆ—é¦–ä½œã€‚ç´„ç¿°Â·å¨å»‰æ–¯çš„é€²è¡Œæ›²ä¸»é¡Œæ°£å‹¢ç£…ç¤´ï¼Œæˆç‚ºå†’éšªé›»å½±å…¸ç¯„ [cite: 10]ã€‚",
                cite: ""
            }
        ];

        // --- 2. éŠæˆ²è®Šæ•¸ ---
        let currentIndex = 0;
        let p1Score = 0;
        let p2Score = 0;
        let gameState = "READY"; // READY, PLAYING, BUZZED, RESULT, END
        let currentAudio = null;
        let activePlayer = null; // 'P1' or 'P2'

        // --- 3. DOM å…ƒç´  ---
        const statusDisplay = document.getElementById('status-display');
        const visualizer = document.getElementById('visualizer');
        const scoreP1 = document.getElementById('score-p1-display');
        const scoreP2 = document.getElementById('score-p2-display');
        
        const btnStart = document.getElementById('btn-start');
        const btnP1 = document.getElementById('btn-p1');
        const btnP2 = document.getElementById('btn-p2');
        const judgeControls = document.getElementById('judge-controls');
        const btnNext = document.getElementById('btn-next');
        
        const resultCard = document.getElementById('result-card');
        const cardTitle = document.getElementById('card-title');
        const cardDesc = document.getElementById('card-desc');
        const cardCite = document.getElementById('card-cite');

        // --- 4. éŠæˆ²é‚è¼¯å‡½æ•¸ ---

        function updateUI() {
            // éš±è—æ‰€æœ‰æ§åˆ¶é …ï¼Œå†æ ¹æ“šç‹€æ…‹é–‹å•Ÿ
            btnStart.style.display = 'none';
            btnP1.style.display = 'none';
            btnP2.style.display = 'none';
            judgeControls.style.display = 'none';
            btnNext.style.display = 'none';
            resultCard.style.display = 'none';
            visualizer.classList.remove('active');

            if (gameState === "READY") {
                statusDisplay.textContent = `ç¬¬ ${currentIndex + 1} é¡Œ / å…± ${MOVIES.length} é¡Œ`;
                statusDisplay.style.color = "#ddd";
                btnStart.style.display = 'block'; // é¡¯ç¤ºé–‹å§‹æŒ‰éˆ•
            } 
            else if (gameState === "PLAYING") {
                statusDisplay.textContent = "ğŸ¶ éŸ³æ¨‚æ’­æ”¾ä¸­... è«‹æ¶ç­”ï¼";
                statusDisplay.style.color = "var(--primary-color)";
                btnP1.style.display = 'block';
                btnP2.style.display = 'block';
                visualizer.classList.add('active');
            } 
            else if (gameState === "BUZZED") {
                statusDisplay.textContent = `âš¡ ç©å®¶ ${activePlayer} æ¶ç­”ä¸­ï¼è«‹å£é ­å›ç­”`;
                statusDisplay.style.color = activePlayer === 'P1' ? 'var(--p1-color)' : 'var(--p2-color)';
                judgeControls.style.display = 'flex'; // é¡¯ç¤ºè£åˆ¤æŒ‰éˆ•
            } 
            else if (gameState === "RESULT") {
                // é¡¯ç¤ºçµæœå¡ç‰‡
                resultCard.style.display = 'block';
                // åˆ¤æ–·æ˜¯å¦é‚„æœ‰ä¸‹ä¸€é¡Œ
                if (currentIndex < MOVIES.length - 1) {
                    btnNext.style.display = 'block';
                    btnNext.textContent = "ä¸‹ä¸€é¡Œ (ç©ºç™½éµ)";
                } else {
                    btnNext.style.display = 'block';
                    btnNext.textContent = "æŸ¥çœ‹æœ€çµ‚æˆç¸¾ (ç©ºç™½éµ)";
                }
            }
            else if (gameState === "END") {
                let winner = "";
                if (p1Score > p2Score) winner = "ğŸ† ç©å®¶ 1 ç²å‹ï¼";
                else if (p2Score > p1Score) winner = "ğŸ† ç©å®¶ 2 ç²å‹ï¼";
                else winner = "ğŸ¤ å¹³æ‰‹ï¼";
                
                statusDisplay.innerHTML = `éŠæˆ²çµæŸ<br>${winner}`;
                statusDisplay.style.color = "var(--primary-color)";
                resultCard.style.display = 'none';
            }

            // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
            scoreP1.textContent = p1Score;
            scoreP2.textContent = p2Score;
        }

        function playMusic() {
            if (currentIndex >= MOVIES.length) return;
            
            // åœæ­¢èˆŠéŸ³æ¨‚
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }

            const movie = MOVIES[currentIndex];
            // å‡è¨­è·¯å¾‘çµæ§‹
            const audioPath = `assets/music/${movie.file}`;
            
            currentAudio = new Audio(audioPath);
            
            // éŒ¯èª¤è™•ç†ï¼šå¦‚æœæ‰¾ä¸åˆ°æª”æ¡ˆï¼Œalert æç¤ºï¼ˆæ–¹ä¾¿é™¤éŒ¯ï¼‰
            currentAudio.onerror = () => {
                console.warn(`æ‰¾ä¸åˆ°éŸ³è¨Šæª”æ¡ˆ: ${audioPath}ï¼Œè«‹ç¢ºèªæª”æ¡ˆæ˜¯å¦ä¸Šå‚³è‡³ assets/music/ è³‡æ–™å¤¾`);
                // å°±ç®—æ²’éŸ³æ¨‚ä¹Ÿè®“éŠæˆ²ç¹¼çºŒ
            };

            currentAudio.play().catch(e => console.log("éœ€ä½¿ç”¨è€…äº’å‹•æ‰èƒ½æ’­æ”¾", e));
            
            gameState = "PLAYING";
            updateUI();
        }

        function handleBuzz(player) {
            if (gameState !== "PLAYING") return;
            
            activePlayer = player;
            if (currentAudio) currentAudio.pause();
            gameState = "BUZZED";
            updateUI();
        }

        function handleJudge(isCorrect) {
            if (gameState !== "BUZZED") return;

            if (isCorrect) {
                if (activePlayer === 'P1') p1Score += 1;
                else p2Score += 1;
                statusDisplay.textContent = "â­• ç­”å°äº†ï¼";
                showResult();
            } else {
                statusDisplay.textContent = "âŒ ç­”éŒ¯äº†... é¡¯ç¤ºç­”æ¡ˆ";
                showResult();
            }
        }

        function showResult() {
            const movie = MOVIES[currentIndex];
            cardTitle.textContent = movie.title;
            cardDesc.textContent = movie.desc;
            cardCite.textContent = `ä¾†æº: ${movie.cite}`;
            
            gameState = "RESULT";
            updateUI();
        }

        function nextRound() {
            if (currentIndex < MOVIES.length - 1) {
                currentIndex++;
                gameState = "READY";
                updateUI();
            } else {
                gameState = "END";
                updateUI();
            }
        }

        // --- 5. äº‹ä»¶ç›£è½ (éµç›¤ & è§¸æ§) ---

        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            const key = e.key.toLowerCase();

            if (gameState === "READY" && key === " ") {
                playMusic();
            }
            else if (gameState === "PLAYING") {
                if (key === "a") handleBuzz('P1');
                if (key === "l") handleBuzz('P2');
            }
            else if (gameState === "BUZZED") {
                if (key === "y") handleJudge(true);
                if (key === "n") handleJudge(false);
            }
            else if (gameState === "RESULT" && key === " ") {
                nextRound();
            }
        });

        // æŒ‰éˆ•é»æ“Š (è§¸æ§æ”¯æ´)
        btnStart.addEventListener('click', playMusic);
        btnP1.addEventListener('click', () => handleBuzz('P1'));
        btnP2.addEventListener('click', () => handleBuzz('P2'));
        document.getElementById('btn-correct').addEventListener('click', () => handleJudge(true));
        document.getElementById('btn-wrong').addEventListener('click', () => handleJudge(false));
        btnNext.addEventListener('click', nextRound);

        // åˆå§‹åŒ–
        updateUI();

    </script>
</body>
</html>
