<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›™äººå°æ‰“éŠæˆ² | Fighting Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
            text-align: center;
        }
        
        header {
            margin-bottom: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff4d4d, #4d79ff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0a0c0;
            margin-bottom: 30px;
        }
        
        .game-area {
            position: relative;
            width: 100%;
            background: rgba(10, 15, 30, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            background: #0a0f1e;
        }
        
        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
        }
        
        .player-ui {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 10px;
            min-width: 180px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .health-bar {
            height: 20px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .health-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s;
        }
        
        .player1-ui .health-fill {
            background: linear-gradient(90deg, #ff4d4d, #ff9999);
        }
        
        .player2-ui .health-fill {
            background: linear-gradient(90deg, #4d79ff, #99bbff);
        }
        
        .skill-bar {
            height: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .skill-fill {
            height: 100%;
            border-radius: 5px;
            background: linear-gradient(90deg, #00cc66, #66ff99);
            transition: width 0.3s;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-card {
            background: rgba(20, 25, 45, 0.8);
            padding: 20px;
            border-radius: 10px;
            min-width: 250px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .control-card h3 {
            margin-bottom: 15px;
            color: #ffcc00;
        }
        
        .key {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-family: monospace;
        }
        
        .game-over, .character-select {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            width: 80%;
            max-width: 600px;
        }
        
        .character-select {
            display: flex;
            flex-direction: column;
        }
        
        .game-over h2, .character-select h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffcc00;
        }
        
        .restart-btn, .start-btn {
            background: linear-gradient(90deg, #ff9900, #ffcc00);
            color: #000;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-top: 15px;
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .restart-btn:hover, .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 204, 0, 0.6);
        }
        
        .character-options {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        .character-option {
            background: rgba(30, 35, 60, 0.8);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            width: 45%;
        }
        
        .character-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.5);
        }
        
        .character-option.selected {
            border: 2px solid #ffcc00;
            box-shadow: 0 0 20px rgba(255, 204, 0, 0.5);
        }
        
        .character-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }
        
        .character-name {
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .character-desc {
            font-size: 0.9rem;
            color: #a0a0c0;
        }
        
        footer {
            margin-top: 20px;
            color: #a0a0c0;
            font-size: 0.9rem;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-card {
                width: 100%;
                max-width: 350px;
            }
            
            .player-ui {
                min-width: 140px;
                padding: 10px;
            }
            
            .player-name {
                font-size: 1rem;
            }
            
            .character-options {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
            
            .character-option {
                width: 90%;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .ui-overlay {
                padding: 10px;
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }
            
            .player-ui {
                width: 100%;
                max-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>é›™äººå°æ‰“éŠæˆ²</h1>
            <p class="subtitle">é¸æ“‡ä½ çš„è§’è‰²ï¼Œèˆ‡æœ‹å‹ä¸€æ±ºé«˜ä¸‹ï¼</p>
        </header>
        
        <div class="game-area">
            <canvas id="gameCanvas"></canvas>
            
            <div class="ui-overlay">
                <div class="player-ui player1-ui">
                    <div class="player-name">ç©å®¶ 1</div>
                    <div class="health-bar">
                        <div class="health-fill" id="p1Health" style="width: 100%"></div>
                    </div>
                    <div>ç”Ÿå‘½å€¼: <span id="p1HealthText">100</span></div>
                    <div class="skill-bar">
                        <div class="skill-fill" id="p1Skill" style="width: 0%"></div>
                    </div>
                    <div>æŠ€èƒ½èƒ½é‡: <span id="p1SkillText">0%</span></div>
                </div>
                
                <div class="player-ui player2-ui">
                    <div class="player-name">ç©å®¶ 2</div>
                    <div class="health-bar">
                        <div class="health-fill" id="p2Health" style="width: 100%"></div>
                    </div>
                    <div>ç”Ÿå‘½å€¼: <span id="p2HealthText">100</span></div>
                    <div class="skill-bar">
                        <div class="skill-fill" id="p2Skill" style="width: 0%"></div>
                    </div>
                    <div>æŠ€èƒ½èƒ½é‡: <span id="p2SkillText">0%</span></div>
                </div>
            </div>
            
            <div class="character-select" id="characterSelect">
                <h2>é¸æ“‡ä½ çš„è§’è‰²</h2>
                <div class="character-options">
                    <div class="character-option" data-character="warrior">
                        <div class="character-icon" style="background: linear-gradient(135deg, #ff4d4d, #cc0000);">âš”ï¸</div>
                        <div class="character-name">æˆ°å£«</div>
                        <div class="character-desc">é«˜ç”Ÿå‘½å€¼ï¼Œæ™®é€šæ”»æ“ŠåŠ›å¼·ï¼ŒæŠ€èƒ½ï¼šæ—‹é¢¨æ–¬</div>
                    </div>
                    <div class="character-option" data-character="mage">
                        <div class="character-icon" style="background: linear-gradient(135deg, #4d79ff, #0044cc);">ğŸ”®</div>
                        <div class="character-name">æ³•å¸«</div>
                        <div class="character-desc">æ™®é€šæ”»æ“ŠåŠ›å¼±ï¼ŒæŠ€èƒ½ï¼šç«çƒè¡“</div>
                    </div>
                </div>
                <button class="start-btn" id="startBtn">é–‹å§‹éŠæˆ²</button>
            </div>
            
            <div class="game-over" id="gameOver">
                <h2 id="winnerText">ç©å®¶ 1 ç²å‹ï¼</h2>
                <p>éŠæˆ²çµæŸï¼Œé»æ“ŠæŒ‰éˆ•é‡æ–°é–‹å§‹</p>
                <button class="restart-btn" id="restartBtn">é‡æ–°é–‹å§‹éŠæˆ²</button>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-card">
                <h3>ç©å®¶ 1 æ§åˆ¶</h3>
                <p><span class="key">W</span> è·³èº</p>
                <p><span class="key">A</span> å‘å·¦ç§»å‹•</p>
                <p><span class="key">D</span> å‘å³ç§»å‹•</p>
                <p><span class="key">F</span> æ”»æ“Š</p>
                <p><span class="key">G</span> ç‰¹æ®ŠæŠ€èƒ½</p>
            </div>
            
            <div class="control-card">
                <h3>ç©å®¶ 2 æ§åˆ¶</h3>
                <p><span class="key">â†‘</span> è·³èº</p>
                <p><span class="key">â†</span> å‘å·¦ç§»å‹•</p>
                <p><span class="key">â†’</span> å‘å³ç§»å‹•</p>
                <p><span class="key">/</span> æ”»æ“Š</p>
                <p><span class="key">.</span> ç‰¹æ®ŠæŠ€èƒ½</p>
            </div>
        </div>
        
        <footer>
            <p>å°ˆç‚º GitHub è¨­è¨ˆ | ä½¿ç”¨ HTML5 Canvas å’Œ JavaScript é–‹ç™¼</p>
        </footer>
    </div>

    <script>
        // éŠæˆ²åˆå§‹åŒ–
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameOverScreen = document.getElementById('gameOver');
        const characterSelectScreen = document.getElementById('characterSelect');
        const winnerText = document.getElementById('winnerText');
        const restartBtn = document.getElementById('restartBtn');
        const startBtn = document.getElementById('startBtn');
        const p1Health = document.getElementById('p1Health');
        const p2Health = document.getElementById('p2Health');
        const p1HealthText = document.getElementById('p1HealthText');
        const p2HealthText = document.getElementById('p2HealthText');
        const p1Skill = document.getElementById('p1Skill');
        const p2Skill = document.getElementById('p2Skill');
        const p1SkillText = document.getElementById('p1SkillText');
        const p2SkillText = document.getElementById('p2SkillText');
        
        // è¨­å®šç•«å¸ƒå°ºå¯¸
        function resizeCanvas() {
            const container = document.querySelector('.game-area');
            canvas.width = container.clientWidth;
            canvas.height = Math.min(600, container.clientWidth * 0.75);
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // é¡è‰²å®šç¾©
        const colors = {
            background: '#0a0f1e',
            platform: '#4a5f8c',
            player1: '#ff4d4d',
            player2: '#4d79ff',
            text: '#ffffff'
        };
        
        // è§’è‰²å®šç¾©
        const characters = {
            warrior: {
                name: "æˆ°å£«",
                color: "#ff4d4d",
                health: 120,
                attackDamage: 8,
                skillDamage: 15,
                skillName: "æ—‹é¢¨æ–¬",
                skillDescription: "å°å‘¨åœæ•µäººé€ æˆç¯„åœå‚·å®³"
            },
            mage: {
                name: "æ³•å¸«",
                color: "#4d79ff",
                health: 80,
                attackDamage: 5,
                skillDamage: 25,
                skillName: "ç«çƒè¡“",
                skillDescription: "ç™¼å°„ç«çƒæ”»æ“Šé è·é›¢æ•µäºº"
            }
        };
        
        // ç©å®¶é¡
        class Player {
            constructor(x, y, character, controls, name) {
                this.x = x;
                this.y = y;
                this.width = 50;
                this.height = 80;
                this.character = character;
                this.color = characters[character].color;
                this.speed = 5;
                this.jumpPower = 15;
                this.velY = 0;
                this.isJumping = false;
                this.health = characters[character].health;
                this.maxHealth = characters[character].health;
                this.attackCooldown = 0;
                this.controls = controls;
                this.name = name;
                this.facingRight = name === "Player 1";
                this.attackAnimation = 0;
                this.onGround = false;
                this.isAttacking = false;
                this.skillEnergy = 0;
                this.skillActive = false;
                this.skillAnimation = 0;
                this.projectiles = [];
            }
            
            draw() {
                // ç¹ªè£½ç©å®¶
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // ç¹ªè£½æ”»æ“Šå‹•ç•«
                if (this.attackAnimation > 0) {
                    ctx.fillStyle = 'rgba(255, 255, 0, 0.5)';
                    const attackX = this.facingRight ? this.x + this.width : this.x - 30;
                    ctx.fillRect(attackX, this.y, 30, this.height);
                    this.attackAnimation--;
                }
                
                // ç¹ªè£½æŠ€èƒ½å‹•ç•«
                if (this.skillAnimation > 0) {
                    if (this.character === 'warrior') {
                        // æˆ°å£«æ—‹é¢¨æ–¬
                        ctx.strokeStyle = 'rgba(255, 215, 0, 0.7)';
                        ctx.lineWidth = 5;
                        ctx.beginPath();
                        ctx.arc(this.x + this.width/2, this.y + this.height/2, 60, 0, Math.PI * 2);
                        ctx.stroke();
                    } else if (this.character === 'mage') {
                        // æ³•å¸«ç«çƒ
                        for (const proj of this.projectiles) {
                            ctx.fillStyle = 'rgba(255, 100, 0, 0.8)';
                            ctx.beginPath();
                            ctx.arc(proj.x, proj.y, 15, 0, Math.PI * 2);
                            ctx.fill();
                            
                            ctx.fillStyle = 'rgba(255, 200, 0, 0.9)';
                            ctx.beginPath();
                            ctx.arc(proj.x, proj.y, 8, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    }
                    this.skillAnimation--;
                }
                
                // ç¹ªè£½çœ¼ç›ï¼ˆæ–¹å‘æŒ‡ç¤ºï¼‰
                ctx.fillStyle = '#ffffff';
                const eyeX = this.facingRight ? this.x + this.width - 15 : this.x + 15;
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 25, 8, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000000';
                ctx.beginPath();
                ctx.arc(eyeX, this.y + 25, 4, 0, Math.PI * 2);
                ctx.fill();
            }
            
            move(keys, platforms) {
                // æ°´å¹³ç§»å‹•
                if (keys[this.controls.left]) {
                    this.x -= this.speed;
                    this.facingRight = false;
                }
                if (keys[this.controls.right]) {
                    this.x += this.speed;
                    this.facingRight = true;
                }
                
                // ç¢ºä¿ç©å®¶ä¸æœƒé›¢é–‹è¢å¹•
                this.x = Math.max(0, Math.min(canvas.width - this.width, this.x));
                
                // é‡åŠ›
                this.velY += 0.5;
                this.y += this.velY;
                
                // è·³èº
                if (keys[this.controls.up] && !this.isJumping && this.onGround) {
                    this.velY = -this.jumpPower;
                    this.isJumping = true;
                    this.onGround = false;
                }
                
                // æª¢æŸ¥æ˜¯å¦ç«™åœ¨å¹³å°ä¸Š
                this.onGround = false;
                for (const platform of platforms) {
                    if (this.y + this.height >= platform.y && 
                        this.y + this.height <= platform.y + 10 &&
                        this.x + this.width > platform.x && 
                        this.x < platform.x + platform.width) {
                        this.y = platform.y - this.height;
                        this.velY = 0;
                        this.isJumping = false;
                        this.onGround = true;
                    }
                }
                
                // æª¢æŸ¥æ˜¯å¦ç«™åœ¨åœ°é¢
                if (this.y + this.height >= canvas.height) {
                    this.y = canvas.height - this.height;
                    this.velY = 0;
                    this.isJumping = false;
                    this.onGround = true;
                }
                
                // æ”»æ“Š
                if (keys[this.controls.attack] && this.attackCooldown === 0) {
                    this.isAttacking = true;
                    this.attackAnimation = 10;
                    this.attackCooldown = 20;
                    this.skillEnergy = Math.min(100, this.skillEnergy + 10);
                }
                
                // ç‰¹æ®ŠæŠ€èƒ½
                if (keys[this.controls.skill] && this.skillEnergy >= 100 && !this.skillActive) {
                    this.skillActive = true;
                    this.skillAnimation = 30;
                    this.skillEnergy = 0;
                    
                    if (this.character === 'mage') {
                        // æ³•å¸«ç™¼å°„ç«çƒ
                        this.projectiles.push({
                            x: this.facingRight ? this.x + this.width : this.x - 15,
                            y: this.y + this.height/2,
                            direction: this.facingRight ? 1 : -1,
                            speed: 8
                        });
                    }
                }
                
                // æ›´æ–°æ³•å¸«ç«çƒä½ç½®
                if (this.character === 'mage') {
                    for (let i = this.projectiles.length - 1; i >= 0; i--) {
                        this.projectiles[i].x += this.projectiles[i].direction * this.projectiles[i].speed;
                        
                        // ç§»é™¤è¶…å‡ºç•«å¸ƒçš„ç«çƒ
                        if (this.projectiles[i].x < 0 || this.projectiles[i].x > canvas.width) {
                            this.projectiles.splice(i, 1);
                        }
                    }
                }
            }
            
            attack(otherPlayer) {
                if (this.isAttacking && this.attackAnimation > 0) {
                    // åŸºæœ¬æ”»æ“Š
                    const attackRange = 70;
                    const horizontalDistance = Math.abs(this.x - otherPlayer.x);
                    const verticalDistance = Math.abs(this.y - otherPlayer.y);
                    
                    if (horizontalDistance < attackRange && verticalDistance < this.height) {
                        const damage = characters[this.character].attackDamage + Math.floor(Math.random() * 6);
                        otherPlayer.health -= damage;
                        this.isAttacking = false;
                        return true;
                    }
                }
                
                // æˆ°å£«æŠ€èƒ½æ”»æ“Š
                if (this.skillActive && this.character === 'warrior') {
                    const skillRange = 100;
                    const horizontalDistance = Math.abs(this.x - otherPlayer.x);
                    const verticalDistance = Math.abs(this.y - otherPlayer.y);
                    
                    if (horizontalDistance < skillRange && verticalDistance < this.height) {
                        const damage = characters[this.character].skillDamage;
                        otherPlayer.health -= damage;
                        this.skillActive = false;
                        return true;
                    }
                }
                
                // æ³•å¸«æŠ€èƒ½æ”»æ“Š
                if (this.character === 'mage') {
                    for (let i = this.projectiles.length - 1; i >= 0; i--) {
                        const proj = this.projectiles[i];
                        const horizontalDistance = Math.abs(proj.x - (otherPlayer.x + otherPlayer.width/2));
                        const verticalDistance = Math.abs(proj.y - (otherPlayer.y + otherPlayer.height/2));
                        
                        if (horizontalDistance < 30 && verticalDistance < 40) {
                            const damage = characters[this.character].skillDamage;
                            otherPlayer.health -= damage;
                            this.projectiles.splice(i, 1);
                            this.skillActive = false;
                            return true;
                        }
                    }
                }
                
                return false;
            }
            
            update() {
                if (this.attackCooldown > 0) {
                    this.attackCooldown--;
                }
                
                // æŠ€èƒ½èƒ½é‡è‡ªç„¶æ¢å¾©
                if (this.skillEnergy < 100) {
                    this.skillEnergy = Math.min(100, this.skillEnergy + 0.2);
                }
                
                // æŠ€èƒ½å‹•ç•«çµæŸå¾Œé‡ç½®
                if (this.skillAnimation <= 0) {
                    this.skillActive = false;
                }
            }
        }
        
        // å¹³å°é¡
        class Platform {
            constructor(x, y, width, height) {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
            }
            
            draw() {
                ctx.fillStyle = colors.platform;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // å¹³å°é ‚éƒ¨é«˜å…‰
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fillRect(this.x, this.y, this.width, 5);
            }
        }
        
        // å‰µå»ºç©å®¶
        let player1, player2;
        
        // å‰µå»ºå¹³å°
        let platforms = [];
        
        function createPlatforms() {
            platforms = [
                new Platform(0, canvas.height - 50, canvas.width, 50),  // åœ°é¢
                new Platform(200, 400, 200, 20),  // å¹³å°1
                new Platform(400, 300, 200, 20),  // å¹³å°2
                new Platform(200, 200, 200, 20),  // å¹³å°3
            ];
        }
        
        // éµç›¤ç‹€æ…‹
        const keys = {};
        
        // éŠæˆ²ç‹€æ…‹
        let gameRunning = false;
        let selectedCharacters = { player1: null, player2: null };
        
        // è§’è‰²é¸æ“‡
        document.querySelectorAll('.character-option').forEach(option => {
            option.addEventListener('click', function() {
                const character = this.getAttribute('data-character');
                
                // ç§»é™¤æ‰€æœ‰é¸æ“‡
                document.querySelectorAll('.character-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // æ¨™è¨˜é¸æ“‡
                this.classList.add('selected');
                
                // å„²å­˜é¸æ“‡
                if (!selectedCharacters.player1) {
                    selectedCharacters.player1 = character;
                } else if (!selectedCharacters.player2) {
                    selectedCharacters.player2 = character;
                }
            });
        });
        
        // é–‹å§‹éŠæˆ²
        startBtn.addEventListener('click', () => {
            if (selectedCharacters.player1 && selectedCharacters.player2) {
                player1 = new Player(100, 300, selectedCharacters.player1, {
                    up: 'KeyW',
                    left: 'KeyA',
                    right: 'KeyD',
                    attack: 'KeyF',
                    skill: 'KeyG'
                }, "Player 1");
                
                player2 = new Player(600, 300, selectedCharacters.player2, {
                    up: 'ArrowUp',
                    left: 'ArrowLeft',
                    right: 'ArrowRight',
                    attack: 'Slash',
                    skill: 'Period'
                }, "Player 2");
                
                characterSelectScreen.style.display = 'none';
                gameRunning = true;
            } else {
                alert('è«‹å…©ä½ç©å®¶éƒ½é¸æ“‡è§’è‰²ï¼');
            }
        });
        
        // éµç›¤äº‹ä»¶ç›£è½
        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            
            // é˜²æ­¢æŒ‰éµé»˜èªè¡Œç‚ºï¼ˆä¾‹å¦‚æ–¹å‘éµæ»¾å‹•é é¢ï¼‰
            if (['KeyW', 'KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyG', 
                 'ArrowUp', 'ArrowLeft', 'ArrowRight', 'ArrowDown', 
                 'Slash', 'Period'].includes(e.code)) {
                e.preventDefault();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // é‡æ–°é–‹å§‹éŠæˆ²
        restartBtn.addEventListener('click', () => {
            player1.health = player1.maxHealth;
            player2.health = player2.maxHealth;
            player1.x = 100;
            player1.y = 300;
            player2.x = 600;
            player2.y = 300;
            player1.velY = 0;
            player2.velY = 0;
            player1.isJumping = false;
            player2.isJumping = false;
            player1.isAttacking = false;
            player2.isAttacking = false;
            player1.attackCooldown = 0;
            player2.attackCooldown = 0;
            player1.skillEnergy = 0;
            player2.skillEnergy = 0;
            player1.projectiles = [];
            player2.projectiles = [];
            gameRunning = true;
            gameOverScreen.style.display = 'none';
        });
        
        // éŠæˆ²ä¸»å¾ªç’°
        function gameLoop() {
            // æ¸…ç©ºç•«å¸ƒ
            ctx.fillStyle = colors.background;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç¹ªè£½å¹³å°
            platforms.forEach(platform => platform.draw());
            
            if (gameRunning && player1 && player2) {
                // æ›´æ–°ç©å®¶ä½ç½®
                player1.move(keys, platforms);
                player2.move(keys, platforms);
                
                // æ›´æ–°ç©å®¶ç‹€æ…‹
                player1.update();
                player2.update();
                
                // æª¢æŸ¥æ”»æ“Š
                player1.attack(player2);
                player2.attack(player1);
                
                // æ›´æ–°UI
                p1Health.style.width = `${Math.max(0, (player1.health / player1.maxHealth) * 100)}%`;
                p2Health.style.width = `${Math.max(0, (player2.health / player2.maxHealth) * 100)}%`;
                p1HealthText.textContent = Math.max(0, Math.round(player1.health));
                p2HealthText.textContent = Math.max(0, Math.round(player2.health));
                
                p1Skill.style.width = `${player1.skillEnergy}%`;
                p2Skill.style.width = `${player2.skillEnergy}%`;
                p1SkillText.textContent = `${Math.round(player1.skillEnergy)}%`;
                p2SkillText.textContent = `${Math.round(player2.skillEnergy)}%`;
                
                // æª¢æŸ¥éŠæˆ²çµæŸæ¢ä»¶
                if (player1.health <= 0 || player2.health <= 0) {
                    gameRunning = false;
                    const winner = player1.health <= 0 ? "ç©å®¶ 2" : "ç©å®¶ 1";
                    winnerText.textContent = `${winner} ç²å‹ï¼`;
                    gameOverScreen.style.display = 'block';
                }
            }
            
            // ç¹ªè£½ç©å®¶
            if (player1 && player2) {
                player1.draw();
                player2.draw();
            }
            
            // ç¹ªè£½éŠæˆ²æ¨™é¡Œ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
            ctx.font = '16px Arial';
            ctx.fillText('é›™äººå°æ‰“éŠæˆ²', 20, 30);
            
            requestAnimationFrame(gameLoop);
        }
        
        // åˆå§‹åŒ–å¹³å°
        createPlatforms();
        
        // å•Ÿå‹•éŠæˆ²å¾ªç’°
        gameLoop();
    </script>
</body>
</html>
