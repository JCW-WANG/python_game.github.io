<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶“å…¸é›»å½±è½éŸ³è¾¨ä½ | Movie Soundtrack Quiz</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary: #e50914; /* Netflix Red */
            --accent: #f5c518;  /* IMDb Gold */
            --text: #ffffff;
            --text-secondary: #b3b3b3;
            --correct: #46d369;
            --wrong: #f44336;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Helvetica Neue', Arial, sans-serif; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Container */
        .app-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            position: relative;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(229, 9, 20, 0.6); }
        .btn-secondary { background: #333; }

        /* Screens */
        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        /* 1. Start Screen */
        h1 { font-size: 2.5rem; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px; }
        .subtitle { color: var(--text-secondary); margin-bottom: 40px; }
        
        /* 2. Game Screen */
        .hud {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--accent);
        }

        .visualizer {
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #333 10%, #000 70%);
            border-radius: 50%;
            margin: 20px auto;
            position: relative;
            border: 5px solid #333;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Vinyl Animation */
        .visualizer.playing { animation: spin 4s linear infinite; border-color: var(--accent); }
        .visualizer::after { content: ''; width: 20px; height: 20px; background: var(--bg-color); border-radius: 50%; position: absolute; }
        .music-icon { font-size: 3rem; opacity: 0.5; }

        .timer-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        .timer-fill {
            height: 100%;
            background: var(--accent);
            width: 100%;
            transition: width 0.1s linear;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            width: 100%;
        }
        .option-btn {
            background: var(--card-bg);
            border: 1px solid #444;
            padding: 15px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 1rem;
        }
        .option-btn:hover { background: #333; border-color: #666; }
        
        /* States for buttons */
        .option-btn.correct { background: var(--correct); border-color: var(--correct); color: black; font-weight: bold; }
        .option-btn.wrong { background: var(--wrong); border-color: var(--wrong); opacity: 0.6; }

        /* 3. Result Overlay/Modal */
        .result-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            text-align: left;
            margin-top: 20px;
            border-left: 5px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .result-title { font-size: 1.5rem; color: var(--accent); margin-bottom: 5px; }
        .result-year { color: #888; font-size: 0.9rem; margin-bottom: 15px; display: block; }
        .result-desc { font-size: 0.95rem; line-height: 1.6; color: #ddd; margin-bottom: 20px; max-height: 200px; overflow-y: auto; }
        
        /* Animations */
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsive */
        @media (min-width: 600px) {
            .options-grid { grid-template-columns: 1fr 1fr; }
            h1 { font-size: 3rem; }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div id="start-screen" class="screen">
        <div style="font-size: 4rem;">ğŸ¬</div>
        <h1>é›»å½±çŒœè¬å¤§å¸«</h1>
        <p class="subtitle">è†è½ç¶“å…¸é…æ¨‚ï¼ŒçŒœå‡ºæ­£ç¢ºé›»å½±</p>
        <div class="instruction" style="background: #222; padding: 15px; border-radius: 10px; margin-bottom: 20px; font-size: 0.9rem;">
            <p>ğŸ§ è«‹é–‹å•ŸéŸ³æ•ˆ</p>
            <p>â±ï¸ æ¯é¡Œæœ‰ 30 ç§’ä½œç­”æ™‚é–“</p>
            <p>ğŸ† ç­”å°å¾— 100 åˆ†ï¼Œç­”éŒ¯ä¸æ‰£åˆ†</p>
        </div>
        <button class="btn" onclick="game.start()">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <div class="hud">
            <span>ç¬¬ <span id="current-q">1</span>/10 é¡Œ</span>
            <span>åˆ†æ•¸: <span id="score">0</span></span>
        </div>

        <div class="visualizer" id="visualizer">
            <div class="music-icon">ğŸµ</div>
        </div>
        
        <div id="status-text" style="height: 20px; margin-bottom: 10px; color: var(--accent);">æ’­æ”¾ä¸­...</div>

        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>

        <div class="options-grid" id="options-container">
            </div>

        <div id="result-section" class="hidden">
            <div class="result-card">
                <h3 class="result-title" id="res-title">é›»å½±æ¨™é¡Œ</h3>
                <span class="result-year" id="res-year">1999</span>
                <p class="result-desc" id="res-desc">é›»å½±æè¿°...</p>
                <button class="btn" id="next-btn" onclick="game.nextQuestion()">ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>
    </div>

    <div id="end-screen" class="screen hidden">
        <h1>éŠæˆ²çµæŸ</h1>
        <p class="subtitle">ä½ çš„æœ€çµ‚å¾—åˆ†</p>
        <div style="font-size: 4rem; color: var(--accent); font-weight: bold; margin: 20px 0;" id="final-score">0</div>
        <p id="feedback-msg">çœ‹ä¾†ä½ éœ€è¦å¤šçœ‹é»é›»å½±äº†ï¼</p>
        <button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
    </div>

    <audio id="bgm-player"></audio>

</div>

<script>
/**
 * è³‡æ–™åº«ï¼šåŒ…å« PDF ä¸­çš„æ‰€æœ‰é›»å½±è³‡è¨Š
 * é‡è¦ï¼šè«‹åœ¨ "driveId" æ¬„ä½å¡«å…¥ä½  Google Drive æª”æ¡ˆçš„ ID
 * (ä¾‹å¦‚é€£çµæ˜¯ https://drive.google.com/file/d/123456789/viewï¼ŒID å°±æ˜¯ 123456789)
 */
const MOVIE_DATA = [
    {
        id: 1,
        title: "The Godfather (æ•™çˆ¶)",
        year: "1972",
        desc: "è¬›è¿°1940å¹´ä»£ç´ç´„é»‘æ‰‹é»¨æŸ¯é‡Œæ˜‚å®¶æ—çš„æ•…äº‹ã€‚æ¢è¨äº†æ¬ŠåŠ›ã€å®¶åº­å€«ç†ã€ç¾åœ‹å¤¢çš„é»‘æš—é¢ã€‚å°¼è«¾Â·ç¾…å¡”çš„é…æ¨‚å“€å‚·è€Œå„ªç¾ï¼Œå®Œç¾è©®é‡‹äº†å®¶æ—çš„æ‚²åŠ‡å‘½é‹ã€‚",
        driveId: "1mtzOEaHkyTDJWUJx7IcMVQEc-XDESjuy" 
    },
    {
        id: 2,
        title: "Star Wars (æ˜Ÿéš›å¤§æˆ°)",
        year: "1977",
        desc: "å¤ªç©ºæ­ŒåŠ‡å·¨ä½œï¼Œå¹´è¼•çš„è·¯å…‹Â·å¤©è¡Œè€…å°æŠ—é‚ªæƒ¡å¸åœ‹ã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„äº¤éŸ¿æ¨‚é…æ¨‚æ°£å‹¢ç£…ç¤´ï¼Œé–‹å ´çš„ä¸»é¡Œæ›²å·²æˆç‚ºå½±å²æœ€çŸ¥åçš„éŸ³æ¨‚ä¹‹ä¸€ã€‚",
        driveId: "1rGaBco16fCX_xoiqR6T45Il1ly4xWMCy"
    },
    {
        id: 3,
        title: "Casablanca (åŒ—éè«œå½±)",
        year: "1942",
        desc: "äºŒæˆ°æ™‚æœŸçš„æ‘©æ´›å“¥ï¼Œé…’å§è€é—†ç‘å…‹åœ¨æ„›æƒ…èˆ‡æ­£ç¾©é–“æŠ‰æ“‡ã€‚ã€ŒAs Time Goes Byã€é€™é¦–æ­Œè²«ç©¿å…¨ç‰‡ï¼Œæˆç‚ºæ°¸æ†çš„æ„›æƒ…è±¡å¾µã€‚",
        driveId: "1ACsVFKbgNu_VQ-xeY_7QQaB1p7mVsGUu"
    },
    {
        id: 4,
        title: "Gone with the Wind (äº‚ä¸–ä½³äºº)",
        year: "1939",
        desc: "ç¾åœ‹å—åŒ—æˆ°çˆ­å²è©©ï¼Œå±•ç¾å—æ–¹ç¤¾æœƒçš„å´©æ½°èˆ‡é‡å»ºã€‚éƒæ€å˜‰èˆ‡ç™½ç‘å¾·çš„æ„›æ¨ç³¾è‘›ã€‚æ¦®ç²åé …å¥§æ–¯å¡çï¼Œå ´é¢å®å¤§ï¼Œæœè£è¯éº—ã€‚",
        driveId: "1WuEggOIWq9wm5IJ4j_y-v8xEoJ6Zl89B"
    },
    {
        id: 5,
        title: "The Wizard of Oz (ç¶ é‡ä»™è¹¤)",
        year: "1939",
        desc: "æ¡ƒæ¨‚çµ²è¢«é¾æ²é¢¨æ²åˆ°å¥§èŒ²åœ‹çš„å¥‡å¹»æ—…ç¨‹ã€‚ã€ŒOver the Rainbowã€æˆç‚ºå½±å²æœ€å‰å¤§çš„é›»å½±æ­Œæ›²ï¼Œå¯“æ„å®¶æ°¸é æ˜¯æœ€æº«æš–çš„åœ°æ–¹ã€‚",
        driveId: "1riBCad4BObnYnIdiddKzZm-hkSv9pEkY"
    },
    {
        id: 6,
        title: "Titanic (éµé”å°¼è™Ÿ)",
        year: "1997",
        desc: "çª®ç•«å®¶å‚‘å…‹èˆ‡è²´æ—å°‘å¥³è˜¿çµ²åœ¨æ²‰èˆ¹å‰çš„åˆ»éª¨éŠ˜å¿ƒæ„›æƒ…ã€‚å¸­ç³Â·ç‹„ç¿æ¼”å”±çš„ã€ŒMy Heart Will Go Onã€é¢¨é¡å…¨çƒã€‚",
        driveId: "1CM8Zdor-AlzAPZF7sSsAewdMl97N6FCL"
    },
    {
        id: 7,
        title: "Jaws (å¤§ç™½é¯Š)",
        year: "1975",
        desc: "å·¨å¤§é£Ÿäººé¯Šæ”»æ“Šåº¦å‡å°é®ã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„å…©éŸ³ç¬¦ä¸»é¡Œæ›²è£½é€ äº†æ¥µå¼·çš„ç·Šå¼µæ„Ÿã€‚é–‹å‰µäº†æš‘æœŸå¤§ç‰‡çš„å•†æ¥­æ¨¡å¼ã€‚",
        driveId: "1o6zBN8J4gEFZ7mZbp4X0uwj-mZKbFDxT"
    },
    {
        id: 8,
        title: "Rocky (æ´›åŸº)",
        year: "1976",
        desc: "ä¸‰æµæ‹³æ“Šæ‰‹æ´›åŸºç²å¾—æŒ‘æˆ°æ‹³ç‹çš„æ©Ÿæœƒã€‚ã€ŒGonna Fly Nowã€çš„æ¿€æ˜‚é…æ¨‚æ­é…éšæ¢¯å¥”è·‘å ´æ™¯ï¼Œæˆç‚ºé«”è‚²é›»å½±æœ€ç¶“å…¸ç•«é¢ã€‚",
        driveId: "13yKggnZ2t6CZbL7esZOhiCwbGYGnDSgI"
    },
    {
        id: 9,
        title: "E.T. the Extra-Terrestrial (E.T.å¤–æ˜Ÿäºº)",
        year: "1982",
        desc: "å°ç”·å­©èˆ‡å¤–æ˜Ÿäººå»ºç«‹è·¨è¶Šç¨®æ—çš„å‹èª¼ã€‚å­©å­å€‘é¨è…³è¸è»Šé£›è¶Šå¤©éš›çš„ç•«é¢æ­é…ç´„ç¿°Â·å¨å»‰æ–¯çš„é…æ¨‚ï¼Œå……æ»¿ç«¥çœŸèˆ‡æ„Ÿå‹•ã€‚",
        driveId: "15R3ICtA6eEdF6-iwPSlrwK3E8PjD7s_F"
    },
    {
        id: 10,
        title: "Raiders of the Lost Ark (æ³•æ«ƒå¥‡å…µ)",
        year: "1981",
        desc: "å°ç¬¬å®‰ç´Â·ç“Šæ–¯å°‹æ‰¾ç´„æ«ƒçš„å…¨çƒå†’éšªã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„é€²è¡Œæ›²ä¸»é¡Œæ°£å‹¢ç£…ç¤´ï¼Œæˆç‚ºå†’éšªé›»å½±éŸ³æ¨‚çš„å…¸ç¯„ã€‚",
        driveId: "1nCn31D4IZ6xQn4Dbt3x-BpzI6iQf6hzW"
    }
];

class GameEngine {
    constructor() {
        this.score = 0;
        this.currentIndex = 0;
        this.timer = null;
        this.timeLeft = 30;
        this.isPlaying = false;
        
        // DOM Elements
        this.screens = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            end: document.getElementById('end-screen')
        };
        this.audioPlayer = document.getElementById('bgm-player');
        this.visualizer = document.getElementById('visualizer');
        this.timerFill = document.getElementById('timer-fill');
        this.statusText = document.getElementById('status-text');
        
        // Shuffle questions
        this.questions = [...MOVIE_DATA].sort(() => Math.random() - 0.5);
    }

    // å°‡ Google Drive ID è½‰æ›ç‚ºå¯æ’­æ”¾é€£çµ
    getAudioUrl(id) {
        // é€™æ˜¯ Google Drive çš„ä¸²æµ API æ ¼å¼
        return `https://drive.google.com/uc?export=download&id=${id}`;
        // æ³¨æ„ï¼šå¦‚æœæª”æ¡ˆå¾ˆå¤§æˆ–æµé‡éé«˜ï¼ŒGoogle å¯èƒ½æœƒé™åˆ¶ã€‚
        // æ¸¬è©¦ç”¨æ™‚ï¼Œå¯ä»¥æ›æˆè‡ªå·±çš„ mp3 é€£çµã€‚
    }

    start() {
        this.switchScreen('game');
        this.loadQuestion();
    }

    switchScreen(name) {
        Object.values(this.screens).forEach(el => el.classList.add('hidden'));
        this.screens[name].classList.remove('hidden');
    }

    loadQuestion() {
        if (this.currentIndex >= this.questions.length) {
            this.endGame();
            return;
        }

        const currentMovie = this.questions[this.currentIndex];
        
        // UI Reset
        document.getElementById('current-q').innerText = this.currentIndex + 1;
        document.getElementById('result-section').classList.add('hidden');
        document.getElementById('options-container').classList.remove('hidden');
        this.visualizer.classList.add('playing');
        this.statusText.innerText = "ğŸ¶ éŸ³æ¨‚æ’­æ”¾ä¸­... è«‹çŒœæ¸¬ï¼";
        
        // Audio
        this.audioPlayer.src = this.getAudioUrl(currentMovie.driveId);
        this.audioPlayer.volume = 0.5;
        // è™•ç†ç€è¦½å™¨è‡ªå‹•æ’­æ”¾é™åˆ¶ï¼šéœ€è¦ç¢ºä¿ä½¿ç”¨è€…æœ‰äº’å‹•é
        const playPromise = this.audioPlayer.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                this.statusText.innerText = "âš ï¸ è«‹é»æ“Šç•«é¢æ’­æ”¾éŸ³æ¨‚";
                document.body.addEventListener('click', () => this.audioPlayer.play(), {once:true});
            });
        }

        // Generate Options (1 Correct + 3 Random Wrong)
        this.generateOptions(currentMovie);

        // Start Timer
        this.timeLeft = 30;
        this.startTimer();
    }

    generateOptions(correctMovie) {
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        // Get 3 unique wrong answers
        let wrongOptions = MOVIE_DATA
            .filter(m => m.id !== correctMovie.id)
            .sort(() => Math.random() - 0.5)
            .slice(0, 3);
        
        let options = [...wrongOptions, correctMovie].sort(() => Math.random() - 0.5);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.title;
            btn.onclick = () => this.checkAnswer(opt, correctMovie, btn);
            container.appendChild(btn);
        });
    }

    startTimer() {
        if(this.timer) clearInterval(this.timer);
        this.timerFill.style.width = '100%';
        
        this.timer = setInterval(() => {
            this.timeLeft--;
            const pct = (this.timeLeft / 30) * 100;
            this.timerFill.style.width = `${pct}%`;

            if (this.timeLeft <= 0) {
                this.handleTimeout();
            }
        }, 1000);
    }

    checkAnswer(selected, correct, btnElement) {
        clearInterval(this.timer);
        this.audioPlayer.pause();
        this.visualizer.classList.remove('playing');
        
        // Disable all buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        let isCorrect = selected.id === correct.id;

        if (isCorrect) {
            btnElement.classList.add('correct');
            this.score += 100;
            // Bonus for time left
            this.score += Math.max(0, this.timeLeft * 2);
            this.statusText.innerText = "âœ… ç­”å°äº†ï¼";
        } else {
            btnElement.classList.add('wrong');
            // Highlight the correct one
            allBtns.forEach(b => {
                if(b.innerText === correct.title) b.classList.add('correct');
            });
            this.statusText.innerText = "âŒ ç­”éŒ¯äº†...";
        }

        document.getElementById('score').innerText = this.score;
        this.showResult(correct);
    }

    handleTimeout() {
        clearInterval(this.timer);
        this.audioPlayer.pause();
        this.visualizer.classList.remove('playing');
        
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.disabled = true;
            // Highlight correct one
            if(b.innerText === this.questions[this.currentIndex].title) b.classList.add('correct');
        });
        
        this.statusText.innerText = "â° æ™‚é–“åˆ°ï¼";
        this.showResult(this.questions[this.currentIndex]);
    }

    showResult(movie) {
        document.getElementById('options-container').classList.add('hidden');
        const resDiv = document.getElementById('result-section');
        resDiv.classList.remove('hidden');
        
        document.getElementById('res-title').innerText = movie.title;
        document.getElementById('res-year').innerText = movie.year;
        document.getElementById('res-desc').innerText = movie.desc;
    }

    nextQuestion() {
        this.currentIndex++;
        this.loadQuestion();
    }

    endGame() {
        this.switchScreen('end');
        document.getElementById('final-score').innerText = this.score;
        
        let msg = "";
        if(this.score >= 1000) msg = "ğŸ¬ å½±å²å¤§å¸«ï¼å¥§æ–¯å¡éä½ è«å±¬ï¼";
        else if(this.score >= 600) msg = "ğŸ¿ è³‡æ·±å½±è¿·ï¼Œè¡¨ç¾ä¸éŒ¯ï¼";
        else msg = "ğŸ“º æ²’é—œä¿‚ï¼Œå›å®¶å†å¤šçœ‹å¹¾éƒ¨é›»å½±å§ï¼";
        
        document.getElementById('feedback-msg').innerText = msg;
    }
}

// Init Game
const game = new GameEngine();

</script>
</body>
</html>
