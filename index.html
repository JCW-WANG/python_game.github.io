<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¶“å…¸é›»å½±è½éŸ³è¾¨ä½ | Movie Soundtrack Quiz</title>
    <style>
        :root {
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --primary: #e50914;
            --accent: #f5c518;
            --text: #ffffff;
            --text-secondary: #b3b3b3;
            --correct: #46d369;
            --wrong: #f44336;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Helvetica Neue', Arial, sans-serif; 
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
            background: linear-gradient(135deg, #121212 0%, #1a1a2e 50%, #16213e 100%);
        }

        .app-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            position: relative;
        }

        .hidden { 
            display: none !important; 
        }

        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, #b80710 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 10px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(229, 9, 20, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .btn:hover::after {
            transform: translateX(0);
        }
        
        .btn:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 20px rgba(229, 9, 20, 0.5); 
        }
        
        .btn:active { 
            transform: translateY(-1px); 
        }
        
        .btn:disabled { 
            background: #555; 
            cursor: not-allowed; 
            transform: none; 
            box-shadow: none; 
        }

        .screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            animation: fadeIn 0.5s ease;
            width: 100%;
        }

        /* 1. Start Screen */
        h1 { 
            font-size: 2.5rem; 
            margin-bottom: 10px; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
            background: linear-gradient(90deg, var(--accent) 0%, #ff9d00 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(245, 197, 24, 0.3);
        }
        
        .subtitle { 
            color: var(--text-secondary); 
            margin-bottom: 30px; 
            font-size: 1.1rem;
        }
        
        .instruction {
            background: rgba(30, 30, 30, 0.8); 
            padding: 20px; 
            border-radius: 15px; 
            margin-bottom: 20px; 
            font-size: 0.95rem;
            line-height: 1.8;
            text-align: left;
            width: 100%;
            border-left: 4px solid var(--accent);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .instruction p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .instruction p:last-child {
            margin-bottom: 0;
        }
        
        .instruction p::before {
            content: '';
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--accent);
            border-radius: 50%;
            margin-right: 10px;
        }

        /* 2. Game Screen */
        .hud {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--accent);
            background: rgba(34, 34, 34, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #ff9d00 100%);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .visualizer-container {
            position: relative;
            margin: 20px auto;
            width: 200px;
            height: 200px;
        }

        .visualizer {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #333 10%, #000 70%);
            border-radius: 50%;
            border: 5px solid #333;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .visualizer::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(
                from 0deg,
                transparent 0%,
                var(--accent) 10%,
                transparent 20%,
                transparent 30%,
                var(--accent) 40%,
                transparent 50%,
                transparent 60%,
                var(--accent) 70%,
                transparent 80%,
                transparent 90%,
                var(--accent) 100%
            );
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .visualizer.playing::before {
            opacity: 0.3;
            animation: rotate 10s linear infinite;
        }
        
        .visualizer.playing { 
            border-color: var(--accent); 
            box-shadow: 0 0 30px rgba(245, 197, 24, 0.4); 
        }
        
        .visualizer::after { 
            content: ''; 
            width: 30px; 
            height: 30px; 
            background: var(--bg-color); 
            border-radius: 50%; 
            position: absolute; 
            z-index: 2;
        }
        
        .music-icon { 
            font-size: 3rem; 
            opacity: 0.7; 
            z-index: 1; 
        }
        
        /* Loading Spinner Over Visualizer */
        .loader {
            border: 4px solid rgba(243, 243, 243, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -20px;
            margin-left: -20px;
            z-index: 10;
        }

        .status-text {
            height: 24px;
            margin-bottom: 10px;
            color: var(--accent);
            font-weight: bold;
            letter-spacing: 1px;
            transition: var(--transition);
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(51, 51, 51, 0.5);
            border-radius: 4px;
            margin: 10px 0 20px 0;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent) 0%, #ff9d00 100%);
            width: 100%;
            transition: width 1s linear;
            border-radius: 4px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            width: 100%;
        }
        
        .option-btn {
            background: var(--card-bg);
            border: 1px solid #444;
            padding: 16px;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .option-btn:hover:not(:disabled)::before {
            opacity: 1;
        }
        
        .option-btn:hover:not(:disabled) { 
            background: #333; 
            border-color: #666; 
            transform: translateY(-3px); 
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .option-btn.correct { 
            background: var(--correct); 
            border-color: var(--correct); 
            color: black; 
            font-weight: bold; 
            transform: scale(1.02);
        }
        
        .option-btn.wrong { 
            background: var(--wrong); 
            border-color: var(--wrong); 
            opacity: 0.7; 
        }

        /* 3. Result Overlay */
        .result-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            text-align: left;
            margin-top: 20px;
            border-left: 5px solid var(--accent);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: fadeIn 0.5s;
            position: relative;
            overflow: hidden;
        }
        
        .result-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(245, 197, 24, 0.05) 0%, transparent 50%);
            z-index: 0;
        }
        
        .result-title { 
            font-size: 1.5rem; 
            color: var(--accent); 
            margin-bottom: 5px; 
            position: relative;
            z-index: 1;
        }
        
        .result-year { 
            color: #888; 
            font-size: 0.9rem; 
            margin-bottom: 15px; 
            display: block; 
            position: relative;
            z-index: 1;
        }
        
        .result-desc { 
            font-size: 0.95rem; 
            line-height: 1.6; 
            color: #ddd; 
            margin-bottom: 20px; 
            position: relative;
            z-index: 1;
        }
        
        /* Animations */
        @keyframes spin { 
            100% { 
                transform: rotate(360deg); 
            } 
        }
        
        @keyframes fadeIn { 
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Score animation */
        .score-change {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            animation: bounce 0.6s ease;
        }
        
        .positive { color: var(--correct); }
        .negative { color: var(--wrong); }

        /* End screen styles */
        .trophy {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        .final-score {
            font-size: 4rem;
            color: var(--accent);
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 20px rgba(245, 197, 24, 0.5);
            animation: pulse 2s infinite;
        }
        
        .feedback-msg {
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.5;
        }

        @media (min-width: 600px) {
            .options-grid { 
                grid-template-columns: 1fr 1fr; 
            }
            
            h1 { 
                font-size: 3rem; 
            }
            
            .visualizer-container {
                width: 220px;
                height: 220px;
            }
        }
    </style>
</head>
<body>

<div class="app-container">
    
    <div id="start-screen" class="screen">
        <div class="trophy" style="font-size: 4rem;">ğŸ¬</div>
        <h1>é›»å½±çŒœè¬å¤§å¸«</h1>
        <p class="subtitle">è½é…æ¨‚ â€¢ çŒœé›»å½± â€¢ æ¸¬å½±ç™¡æŒ‡æ•¸</p>
        
        <div class="instruction">
            <p><b>é–‹å•ŸéŸ³æ•ˆ</b>ï¼šéƒ¨åˆ†ç€è¦½å™¨éœ€æ‰‹å‹•å…è¨±æ’­æ”¾ã€‚</p>
            <p><b>é™æ™‚æŒ‘æˆ°</b>ï¼šæ¯é¡Œæœ‰ 30 ç§’ä½œç­”æ™‚é–“ã€‚</p>
            <p><b>è†è½æç¤º</b>ï¼šéŸ³æ¨‚è¼‰å…¥å¾Œè¨ˆæ™‚æ‰æœƒé–‹å§‹ã€‚</p>
            <p><b>å¾—åˆ†è¦å‰‡</b>ï¼šç­”å°å¾—100åˆ†ï¼Œæ¯å‰©é¤˜ä¸€ç§’åŠ 2åˆ†ã€‚</p>
        </div>
        
        <button class="btn" id="start-btn">é–‹å§‹éŠæˆ²</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <div class="hud">
            <span>ç¬¬ <span id="current-q">1</span>/10 é¡Œ</span>
            <span>åˆ†æ•¸: <span id="score">0</span></span>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill" style="width: 10%;"></div>
        </div>

        <div class="visualizer-container">
            <div class="visualizer" id="visualizer">
                <div class="music-icon">ğŸµ</div>
            </div>
            <div id="loading-spinner" class="loader hidden"></div>
        </div>
        
        <div id="status-text" class="status-text">æº–å‚™æ’­æ”¾...</div>

        <div class="timer-bar">
            <div class="timer-fill" id="timer-fill"></div>
        </div>

        <div class="options-grid" id="options-container">
            </div>

        <div id="result-section" class="hidden">
            <div class="result-card">
                <h3 class="result-title" id="res-title">é›»å½±æ¨™é¡Œ</h3>
                <span class="result-year" id="res-year">1999</span>
                <p class="result-desc" id="res-desc">æè¿°...</p>
                <button class="btn" id="next-btn">ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>
    </div>

    <div id="end-screen" class="screen hidden">
        <div class="trophy">ğŸ†</div>
        <h1>éŠæˆ²çµæŸ</h1>
        <p class="subtitle">ä½ çš„æœ€çµ‚å¾—åˆ†</p>
        <div class="final-score" id="final-score">0</div>
        <p class="feedback-msg" id="feedback-msg">...</p>
        <button class="btn" id="restart-btn">å†ç©ä¸€æ¬¡</button>
    </div>

    <audio id="bgm-player" preload="auto"></audio>

</div>

<script>
const MOVIE_DATA = [
    {
        id: 1,
        title: "The Godfather (æ•™çˆ¶)",
        year: "1972",
        desc: "ç”±æ³•è˜­è¥¿æ–¯Â·æŸ¯æ³¢æ‹‰åŸ·å°ï¼Œæ”¹ç·¨è‡ªé¦¬é‡Œå¥§Â·æ™®ä½çš„åŒåå°èªªã€‚é›»å½±è¬›è¿°1940å¹´ä»£ç´ç´„é»‘æ‰‹é»¨å’Œé‡Œæ˜‚å®¶æ—çš„æ•…äº‹ï¼Œé¦¬é¾Â·ç™½è˜­åº¦é£¾æ¼”æ•™çˆ¶ç¶­æ‰˜Â·æŸ¯é‡Œæ˜‚ï¼Œè‰¾çˆ¾Â·å¸•è¥¿è«¾é£¾æ¼”ä»–çš„å°å…’å­éº¥å¯ã€‚æ•…äº‹å¾æ•™çˆ¶å¥³å…’çš„å©šç¦®é–‹å§‹ï¼Œé€æ¼¸å±•ç¾å®¶æ—å…§éƒ¨çš„æ¬ŠåŠ›é¬¥çˆ­ã€å¹«æ´¾ç«æ‹¼ä»¥åŠéº¥å¯å¾æˆ°çˆ­è‹±é›„è½‰è®Šç‚ºå†·é…·é»‘å¹«é ˜è¢–çš„éç¨‹ã€‚é›»å½±æ¢è¨äº†æ¬ŠåŠ›ã€å®¶åº­å€«ç†ã€ç¾åœ‹å¤¢çš„é»‘æš—é¢ï¼Œä»¥åŠç§»æ°‘åœ¨ç¾åœ‹ç¤¾æœƒä¸­çš„æ™æ‰ã€‚å°¼è«¾Â·ç¾…å¡”çš„é…æ¨‚å“€å‚·è€Œå„ªç¾ï¼Œå®Œç¾è©®é‡‹äº†å®¶æ—çš„æ‚²åŠ‡å‘½é‹ã€‚æ¦®ç²1973å¹´å¥§æ–¯å¡æœ€ä½³å½±ç‰‡ã€æœ€ä½³ç”·ä¸»è§’ã€æœ€ä½³æ”¹ç·¨åŠ‡æœ¬ä¸‰é …å¤§çã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/lkjvtyebrs86ldetb2zmf/The-Godfather-1972-victoslava-youtube.mp3?rlkey=qfvu8gxznfhy3cdsoec51kqox&st=ipkjs0v5&raw=1" 
    },
    {
        id: 2,
        title: "Star Wars (æ˜Ÿéš›å¤§æˆ°)",
        year: "1977",
        desc: "å–¬æ²»Â·ç›§å¡æ–¯ç·¨åŠ‡åŸ·å°çš„å¤ªç©ºæ­ŒåŠ‡å·¨ä½œï¼Œé–‹å‰µäº†ç¾ä»£ç§‘å¹»é›»å½±çš„æ–°æ™‚ä»£ã€‚æ•…äº‹è¨­å®šåœ¨é™é çš„éŠ€æ²³ç³»ï¼Œå¹´è¼•çš„è·¯å…‹Â·å¤©è¡Œè€…åœ¨æ­æ¯”äºÂ·è‚¯è«¾æ¯”çš„æŒ‡å¼•ä¸‹ï¼Œèˆ‡èµ°ç§çŠ¯éŸ“æ£®ç¾…ã€è‰äºå…¬ä¸»ä¸€èµ·å°æŠ—é‚ªæƒ¡çš„éŠ€æ²³å¸åœ‹å’Œé»‘æ­¦å£«é”æ–¯Â·ç¶­é”ã€‚é›»å½±èåˆäº†è¥¿éƒ¨ç‰‡ã€æ­¦ä¿ ç‰‡ã€äºŒæˆ°ç©ºæˆ°ç‰‡çš„å…ƒç´ ï¼Œå‰µé€ å‡ºç¨ç‰¹çš„å¤ªç©ºå†’éšªé¢¨æ ¼ã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„äº¤éŸ¿æ¨‚é…æ¨‚æ°£å‹¢ç£…ç¤´ï¼Œé–‹å ´çš„ä¸»é¡Œæ›²å·²æˆç‚ºå½±å²æœ€çŸ¥åçš„éŸ³æ¨‚ä¹‹ä¸€ã€‚é›»å½±é‹ç”¨çªç ´æ€§çš„ç‰¹æ•ˆæŠ€è¡“ï¼Œå‰µç«‹äº†å·¥æ¥­å…‰é­”ç‰¹æ•ˆå…¬å¸ï¼Œå¾¹åº•æ”¹è®Šäº†é›»å½±å·¥æ¥­ã€‚è¡ç”Ÿå‡ºé¾å¤§çš„ç³»åˆ—é›»å½±ã€å‹•ç•«ã€å°èªªã€éŠæˆ²ç­‰è·¨åª’é«”å¸åœ‹ï¼Œå½±éŸ¿äº†æ•¸ä»£è§€çœ¾ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/8daria055z63dzo7jej9i/Star-Wars-Music-Poyoko-youtube.mp3?rlkey=78zbfg6wxghvsz7znb6roogtg&st=g587lj7m&raw=1"
    },
    {
        id: 3,
        title: "Casablanca (åŒ—éè«œå½±)",
        year: "1942",
        desc: "éº¥å¯Â·å¯‡è’‚æ–¯åŸ·å°çš„é»‘ç™½ç¶“å…¸ï¼Œäº¨å¼—èŠÂ·é®‘å˜‰é£¾æ¼”ä¸–æ•…å«‰ä¿—çš„é…’å§è€é—†ç‘å…‹ï¼Œè‹±æ ¼éº—Â·æ„›æ›¼é£¾æ¼”ä»–çš„èˆŠæƒ…äººä¼Šçˆ¾èã€‚æ•…äº‹ç™¼ç”Ÿåœ¨äºŒæˆ°æ™‚æœŸçš„æ‘©æ´›å“¥å¡è–©å¸ƒè˜­å¡ï¼Œé€™è£¡æ˜¯æ­æ´²é›£æ°‘é€ƒå¾€ç¾åœ‹çš„ä¸­è½‰ç«™ã€‚ä¼Šçˆ¾èèˆ‡åç´ç²¹é ˜è¢–ä¸ˆå¤«ç¶­å…‹å¤šçªç„¶å‡ºç¾åœ¨ç‘å…‹çš„é…’å§ï¼Œè«‹æ±‚ä»–å¹«å¿™å–å¾—é€šè¡Œè­‰ã€‚é›»å½±åœ¨æ„›æƒ…èˆ‡æ­£ç¾©ä¹‹é–“å–å¾—å®Œç¾å¹³è¡¡ï¼Œç‘å…‹æœ€çµ‚é¸æ“‡çŠ§ç‰²å€‹äººå¹¸ç¦ä¾†æ”¯æŒåæ³•è¥¿æ–¯äº‹æ¥­ã€‚ã€ŒAs Time Goes Byã€é€™é¦–æ­Œè²«ç©¿å…¨ç‰‡ï¼Œæˆç‚ºæ°¸æ†çš„æ„›æƒ…è±¡å¾µã€‚ç¶“å…¸å°è©ã€Œé€™æ˜¯ä¸€æ®µç¾å¥½å‹èª¼çš„é–‹å§‹ã€ã€ã€Œä¸–ç•Œä¸Šæœ‰é‚£éº¼å¤šé…’é¤¨ï¼Œå¥¹å»èµ°é€²äº†æˆ‘çš„ã€æµå‚³è‡³ä»Šã€‚æ¦®ç²1944å¹´å¥§æ–¯å¡æœ€ä½³å½±ç‰‡ã€æœ€ä½³å°æ¼”ã€æœ€ä½³æ”¹ç·¨åŠ‡æœ¬ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/twusk57y2rh3dth5bnz9n/Casablanca-kuang-Lee-youtube.mp3?rlkey=h79zacik0ahc4a0dxopmrgpr7&st=ut0obki9&raw=1"
    },
    {
        id: 4,
        title: "Gone with the Wind (äº‚ä¸–ä½³äºº)",
        year: "1939",
        desc: "ç¶­å…‹å¤šÂ·å¼—èŠæ˜åŸ·å°çš„å²è©©å·¨ä½œï¼Œæ”¹ç·¨è‡ªç‘ªæ ¼éº—ç‰¹Â·ç±³å¥‘çˆ¾çš„æš¢éŠ·å°èªªã€‚è²»é›¯Â·éº—é£¾æ¼”ç¾åœ‹å—æ–¹èŠåœ’åƒé‡‘éƒæ€å˜‰ï¼Œå…‹æ‹‰å…‹Â·è“‹åšé£¾æ¼”ç©ä¸–ä¸æ­çš„å•†äººç™½ç‘å¾·ã€‚æ•…äº‹å¾å—åŒ—æˆ°çˆ­å‰å¤•é–‹å§‹ï¼Œè·¨è¶Šåå¤šå¹´æ™‚é–“ï¼Œå‘ˆç¾äº†å—æ–¹ç¤¾æœƒçš„å´©æ½°èˆ‡é‡å»ºã€‚éƒæ€å˜‰æ˜¯å€‹è¤‡é›œçš„å¥³æ€§è§’è‰²ï¼šè‡ªç§ã€ä»»æ€§ã€å»åˆå …éŸŒä¸æ‹”ã€‚å¥¹æ„›è‘—æº«æ–‡å„’é›…çš„è‰¾å¸Œç¦®ï¼Œå»ä¸‰æ¬¡å«çµ¦åˆ¥äººï¼Œæœ€çµ‚å¤±å»äº†çœŸæ­£æ„›å¥¹çš„ç™½ç‘å¾·ã€‚é›»å½±å±•ç¾äº†æˆ°çˆ­çš„æ®˜é…·ã€ç¨®æ—å•é¡Œã€å¥³æ€§ç¨ç«‹ç­‰ä¸»é¡Œã€‚ç‰‡é•·238åˆ†é˜ï¼Œå ´é¢å®å¤§ï¼Œæœè£è¯éº—ï¼ŒæŠ€è¡“é–‹å‰µå½©è‰²é›»å½±çš„æ–°æ¨™æº–ã€‚ã€Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ã€æˆç‚ºå‹µå¿—åè¨€ã€‚æ¦®ç²åé …å¥§æ–¯å¡çï¼ŒåŒ…æ‹¬æœ€ä½³å½±ç‰‡ã€æœ€ä½³å°æ¼”ã€æœ€ä½³å¥³ä¸»è§’ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/cg6wnfvpbvhputd9kb7yl/My-Own-True-Love-Nana-Mouskouri-1939-YN-youtube.mp3?rlkey=hjd90uclmbf5lf18e2mjdbgzl&st=rwverrzd&raw=1"
    },
    {
        id: 5,
        title: "The Wizard of Oz (ç¶ é‡ä»™è¹¤)",
        year: "1939",
        desc: "ç¶­å…‹å¤šÂ·å¼—èŠæ˜åŸ·å°çš„å¥‡å¹»éŸ³æ¨‚æ­Œèˆç‰‡ï¼Œæ”¹ç·¨è‡ªæ³•è˜­å…‹Â·é®‘å§†çš„ç«¥è©±å°èªªã€‚èŒ±è’‚Â·å˜‰è˜­é£¾æ¼”å ªè–©æ–¯è¾²å ´å¥³å­©æ¡ƒæ¨‚çµ²ï¼Œå¥¹åœ¨é¾æ²é¢¨ä¸­è¢«æ²åˆ°ç¥å¥‡çš„å¥§èŒ²åœ‹ã€‚ç‚ºäº†å›å®¶ï¼Œå¥¹å¿…é ˆæ²¿è‘—é»ƒç£šè·¯å‰å¾€ç¿¡ç¿ åŸå°‹æ‰¾å‰å¤§çš„å¥§èŒ²å·«å¸«ã€‚æ—…é€”ä¸­å¥¹çµè­˜äº†æƒ³è¦è…¦å­çš„ç¨»è‰äººï¼Œæƒ³è¦å¿ƒè‡Ÿçš„éŒ«æ¨µå¤«ï¼Œæƒ³è¦å‹‡æ°£çš„è†½å°ç…ã€‚é›»å½±å‰æ®µæ˜¯é»‘ç™½ç•«é¢ï¼Œé€²å…¥å¥§èŒ²åœ‹å¾Œè½‰ç‚ºé®®è±”çš„å½©è‰²ï¼Œè¦–è¦ºæ•ˆæœé©šäººã€‚ã€ŒOver the Rainbowã€é€™é¦–æ­Œæ›²è¡¨é”äº†å°ç¾å¥½æœªä¾†çš„åš®å¾€ï¼Œæˆç‚ºå½±å²æœ€å‰å¤§çš„é›»å½±æ­Œæ›²ã€‚æ•…äº‹å¯“æ„æ·±åˆ»ï¼šæ¯å€‹äººéƒ½å·²æ“æœ‰è‡ªå·±å°‹æ‰¾çš„æ±è¥¿ï¼Œå®¶æ°¸é æ˜¯æœ€æº«æš–çš„åœ°æ–¹ã€‚é›»å½±é‹ç”¨å‰µæ–°çš„ç‰¹æ•ˆæŠ€è¡“ï¼ŒåŒ…æ‹¬é¾æ²é¢¨å ´æ™¯å’Œé£›å¤©çŒ´å­ï¼Œæˆç‚ºå¥‡å¹»é›»å½±çš„é‡Œç¨‹ç¢‘ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/aazwjtn79toj2exbkwm5y/Somewhere-Over-the-Rainbow-The-Wizard-of-Oz-youtube.mp3?rlkey=6h4irhdimqbz0v8uf59cey5ze&st=uv46sah8&raw=1"
    },
    {
        id: 6,
        title: "Titanic (éµé”å°¼è™Ÿ)",
        year: "1997",
        desc: "è©¹å§†æ–¯Â·å¡éº¥éš†ç·¨åŠ‡åŸ·å°çš„ç½é›£æ„›æƒ…å²è©©ï¼Œè€—è³‡2å„„ç¾å…ƒæ‰“é€ ï¼Œç•¶æ™‚æ˜¯å½±å²æœ€æ˜‚è²´çš„é›»å½±ã€‚æå¥§ç´å¤šÂ·ç‹„å¡çš®æ­é£¾æ¼”çª®ç•«å®¶å‚‘å…‹ï¼Œå‡±ç‰¹Â·æº«çµ²è•¾é£¾æ¼”ä¸Šæµç¤¾æœƒå°‘å¥³è˜¿çµ²ã€‚1912å¹´4æœˆï¼Œéµé”å°¼è™Ÿé¦–èˆªæ™‚ï¼Œå…©äººåœ¨èˆ¹ä¸Šç›¸é‡ä¸¦å¢œå…¥æ„›æ²³ï¼Œæ‰“ç ´éšç´šè—©ç±¬ã€‚ç„¶è€Œè±ªè¯éƒµè¼ªåœ¨æ’ä¸Šå†°å±±å¾Œé–‹å§‹ä¸‹æ²‰ï¼Œå‚‘å…‹ç‚ºæ•‘è˜¿çµ²è€ŒçŠ§ç‰²ã€‚é›»å½±æ¡ç”¨ç¾ä»£èˆ‡éå»äº¤éŒ¯çš„æ•…äº‹æ‰‹æ³•ï¼Œç”±å¹´é‚çš„è˜¿çµ²å›æ†¶é€™æ®µåˆ»éª¨éŠ˜å¿ƒçš„æ„›æƒ…ã€‚å¡éº¥éš†é‡ç¾äº†éµé”å°¼è™Ÿçš„è±ªè¯å…§è£å’Œæ²‰èˆ¹çš„éœ‡æ’¼å ´é¢ï¼Œç‰¹æ•ˆå’Œå¯¦æ™¯æ‹æ”çµåˆå®Œç¾ã€‚å¸­ç³Â·ç‹„ç¿æ¼”å”±çš„ä¸»é¡Œæ›²ã€ŒMy Heart Will Go Onã€é¢¨é¡å…¨çƒï¼Œæˆç‚ºæ„›æƒ…é›»å½±çš„ä»£è¡¨æ­Œæ›²ã€‚é›»å½±æ¢è¨äº†éšç´šå·®ç•°ã€ç”Ÿå‘½åƒ¹å€¼ã€çœŸæ„›çš„æ„ç¾©ã€‚æ¦®ç²11é …å¥§æ–¯å¡çï¼Œå¹³å¥§æ–¯å¡å²ä¸Šæœ€é«˜ç´€éŒ„ï¼Œå…¨çƒç¥¨æˆ¿è¶…é22å„„ç¾å…ƒã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/zjm7x8stg6e8enq73suz5/Titanic-My-Heart-Will-Go-On-Celine-Dion-HD-Film-Tributes-youtube.mp3?rlkey=g6qwmu3pmq8qf8t44ifn3ftaw&st=8erk3hfg&raw=1"
    },
    {
        id: 7,
        title: "Jaws (å¤§ç™½é¯Š)",
        year: "1975",
        desc: "å²è’‚èŠ¬Â·å²åŒ¹æŸåŸ·å°çš„é©šæ‚šç½é›£ç‰‡ï¼Œæ”¹ç·¨è‡ªå½¼å¾—Â·æœ¬å¥‡åˆ©çš„å°èªªã€‚æ•…äº‹ç™¼ç”Ÿåœ¨ç¾åœ‹æ±å²¸çš„åº¦å‡å°é®è‰¾ç±³è’‚å³¶ï¼Œä¸€æ¢å·¨å¤§çš„é£Ÿäººé¯Šé–‹å§‹æ”»æ“ŠéŠå®¢ã€‚è­¦é•·å¸ƒæ´›è¿ªã€æµ·æ´‹ç”Ÿç‰©å­¸å®¶èƒ¡æŸã€çµé¯Šè€æ‰‹æ˜†ç‰¹çµ„æˆä¸‰äººå°éšŠå‡ºæµ·çµæ®ºé€™æ¢é¯Šé­šã€‚é›»å½±å‰åŠéƒ¨åˆ†è‘—é‡ç‡Ÿé€ ææ€–æ°›åœï¼Œé¯Šé­šå¾ˆå°‘éœ²é¢ï¼Œé€éå—å®³è€…è¦–è§’å’Œç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„å…©éŸ³ç¬¦ä¸»é¡Œæ›²(æ¨¡ä»¿é¯Šé­šé€¼è¿‘çš„ç¯€å¥)è£½é€ ç·Šå¼µæ„Ÿã€‚å¾ŒåŠéƒ¨å‰‡æ˜¯é©šå¿ƒå‹•é­„çš„æµ·ä¸Šå°æ±ºã€‚å²åŒ¹æŸå·§å¦™é‹ç”¨æ‡¸ç–‘æ‰‹æ³•ï¼Œç”¨æœ€å°‘çš„é¯Šé­šç•«é¢å‰µé€ æœ€å¤§çš„ææ‡¼ã€‚é›»å½±æ¢è¨äº†äººé¡å°è‡ªç„¶çš„ææ‡¼ã€å°é®åˆ©ç›Šèˆ‡å…¬å…±å®‰å…¨çš„è¡çªã€äººæ€§åœ¨å±æ©Ÿä¸­çš„å±•ç¾ã€‚é–‹å‰µäº†æš‘æœŸå¤§ç‰‡çš„å•†æ¥­æ¨¡å¼ï¼Œæ”¹è®Šäº†å¥½èŠå¡¢çš„ç™¼è¡Œç­–ç•¥ã€‚æ¦®ç²ä¸‰é …å¥§æ–¯å¡çï¼ŒåŒ…æ‹¬æœ€ä½³åŸå‰µé…æ¨‚ï¼Œå…¨çƒç¥¨æˆ¿çªç ´4.7å„„ç¾å…ƒã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/1f5mmkdfnpuxa9zji302s/Main-Title-John-Williams-youtube.mp3?rlkey=ywdsxq9zjza2rh4r435ek9oic&st=pfag66ar&raw=1"
    },
    {
        id: 8,
        title: "Rocky (æ´›åŸº)",
        year: "1976",
        desc: "ç´„ç¿°Â·è‰¾ç¶­æ£®åŸ·å°ï¼Œå¸­ç¶­æ–¯Â·å²ç‰¹é¾è‡ªç·¨è‡ªæ¼”çš„å‹µå¿—æ‹³æ“Šç‰‡ã€‚å²ç‰¹é¾é£¾æ¼”ä¸‰æµæ‹³æ“Šæ‰‹æ´›åŸºÂ·å·´å¸ƒäºï¼Œç¶½è™Ÿã€Œç¾©å¤§åˆ©ç¨®é¦¬ã€ï¼Œåœ¨è²»åŸè²§æ°‘å€é æ‰“é»‘æ‹³å’Œç‚ºé«˜åˆ©è²¸è¨å‚µç¶­ç”Ÿã€‚ä¸–ç•Œé‡é‡ç´šæ‹³ç‹é˜¿æ³¢ç¾…Â·å…‹é‡Œå¾·ç‚ºäº†å®£å‚³ï¼Œæ±ºå®šçµ¦ä¸€å€‹ç„¡åå°å’æŒ‘æˆ°æ©Ÿæœƒï¼Œæ´›åŸºæ„å¤–ç²é¸ã€‚åœ¨æ•™ç·´ç±³åŸºçš„è¨“ç·´ä¸‹ï¼Œæ´›åŸºå±•é–‹é­”é¬¼è¨“ç·´ï¼ŒåŒæ™‚èˆ‡å®³ç¾çš„å¯µç‰©åº—åº—å“¡æ„›å¾·éº—å®‰ç™¼å±•å‡ºæº«é¦¨çš„æ„›æƒ…ã€‚é›»å½±é«˜æ½®æ˜¯æ´›åŸºèˆ‡é˜¿æ³¢ç¾…çš„15å›åˆè¡€æˆ°ï¼Œé›–ç„¶æœ€çµ‚ä»¥äº›å¾®åˆ†æ•¸è½æ•—ï¼Œä½†ä»–æ’å®Œå…¨å ´ï¼Œè­‰æ˜äº†è‡ªå·±ä¸æ˜¯å»¢ç‰©ã€‚ã€ŒGonna Fly Nowã€çš„æ¿€æ˜‚é…æ¨‚æ­é…æ´›åŸºåœ¨è²»åŸç¾è¡“é¤¨éšæ¢¯å¥”è·‘çš„è¨“ç·´å ´æ™¯ï¼Œæˆç‚ºé«”è‚²é›»å½±æœ€ç¶“å…¸çš„ç•«é¢ã€‚é›»å½±ä»¥å°æˆæœ¬(ç´„100è¬ç¾å…ƒ)å‰µé€ å¤§æˆåŠŸï¼Œç¥¨æˆ¿è¶…é2.25å„„ç¾å…ƒã€‚æ¢è¨äº†å°äººç‰©è¿½å¤¢ã€è‡ªæˆ‘åƒ¹å€¼ã€æ„›æƒ…èˆ‡å …æŒçš„ä¸»é¡Œã€‚æ¦®ç²1977å¹´å¥§æ–¯å¡æœ€ä½³å½±ç‰‡ã€æœ€ä½³å°æ¼”ï¼Œä¸¦è¡ç”Ÿå‡ºå…«éƒ¨çºŒé›†ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/euosj0j00pj3z5m2fd9kl/Rocky-OST-Gonna-Fly-Now-Going-The-Distance-The-Final-Bell-youtube.mp3?rlkey=nqh2ds67wly6uzqo0e312uvms&st=4yitm5hp&raw=1"
    },
    {
        id: 9,
        title: "E.T. the Extra-Terrestrial (E.T.å¤–æ˜Ÿäºº)",
        year: "1982",
        desc: "å²è’‚èŠ¬Â·å²åŒ¹æŸåŸ·å°çš„ç§‘å¹»æº«æƒ…ç‰‡ï¼Œæ˜¯80å¹´ä»£æœ€å…·ä»£è¡¨æ€§çš„å®¶åº­é›»å½±ã€‚æ•…äº‹è¬›è¿°å¤–æ˜ŸäººE.T.æ„å¤–è¢«åŒä¼´éºç•™åœ¨åœ°çƒï¼Œè¢«10æ­²ç”·å­©è‰¾ç•¥ç‰¹ç™¼ç¾ä¸¦æ”¶ç•™ã€‚è‰¾ç•¥ç‰¹èˆ‡å“¥å“¥ã€å¦¹å¦¹ä¸€èµ·ç…§é¡§E.T.,ä»–å€‘ä¹‹é–“å»ºç«‹èµ·è·¨è¶Šç¨®æ—çš„æ·±åšå‹èª¼ã€‚E.T.æƒ³å¿µå®¶é„‰ï¼Œç”¨è¶…èƒ½åŠ›çµ„è£é€šè¨Šè£ç½®å‘¼å«åŒä¼´ã€‚ç•¶æ”¿åºœæ¢å“¡ç™¼ç¾E.T.çš„å­˜åœ¨ä¸¦å±•é–‹è¿½æ•æ™‚ï¼Œå­©å­å€‘é¨è‘—è…³è¸è»Šè¼‰è‘—E.T.é€ƒäº¡ï¼Œåœ¨æœˆå…‰ä¸‹é£›è¶Šå¤©éš›çš„ç•«é¢æˆç‚ºé›»å½±å²ä¸Šæœ€ç¶“å…¸çš„é¡é ­ã€‚ç´„ç¿°Â·å¨å»‰æ–¯çš„é…æ¨‚å……æ»¿ç«¥çœŸã€ç¥ç§˜èˆ‡æ„Ÿå‹•ï¼Œå®Œç¾è¥¯æ‰˜å‡ºå‹èª¼èˆ‡é›¢åˆ¥çš„æƒ…æ„Ÿã€‚é›»å½±å¾å­©å­çš„è¦–è§’å‡ºç™¼ï¼Œå¤§äººçš„è‡‰å­”å¾ˆå°‘å®Œæ•´å‡ºç¾ï¼Œå¼·åŒ–äº†å…’ç«¥æœ¬ä½çš„è§€é»ã€‚æ¢è¨äº†å­¤ç¨ã€å‹èª¼ã€å®¶åº­ã€æˆé•·ç­‰ä¸»é¡Œã€‚E.T.çš„å½¢è±¡è¨­è¨ˆç¨ç‰¹ï¼Œã€ŒE.T. phone homeã€æˆç‚ºæµè¡Œæ–‡åŒ–çš„ä¸€éƒ¨åˆ†ã€‚æ¦®ç²å››é …å¥§æ–¯å¡çï¼Œå…¨çƒç¥¨æˆ¿è¶…é7.9å„„ç¾å…ƒï¼Œä¿æŒç¥¨æˆ¿å† è»ç´€éŒ„åå¤šå¹´ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/p2c1iitbtuq3mcueqenwg/E.T.-Theme-Song-EpicMusicStar-youtube.mp3?rlkey=qx3fs54qylxzizkf46d419as5&st=s5smfelb&raw=1"
    },
    {
        id: 10,
        title: "Raiders of the Lost Ark (æ³•æ«ƒå¥‡å…µ)",
        year: "1981",
        desc: "å²è’‚èŠ¬Â·å²åŒ¹æŸåŸ·å°ï¼Œå–¬æ²»Â·ç›§å¡æ–¯æ“”ä»»ç›£è£½å’Œç·¨åŠ‡ï¼Œé–‹å‰µäº†å°ç¬¬å®‰ç´Â·ç“Šæ–¯ç³»åˆ—ã€‚å“ˆé‡ŒéœÂ·ç¦ç‰¹é£¾æ¼”è€ƒå¤å­¸æ•™æˆå…¼å†’éšªå®¶å°ç¬¬å®‰ç´Â·ç“Šæ–¯ï¼Œä»–åœ¨å¤§å­¸æ•™æ›¸æ™‚æ˜¯æ–¯æ–‡çš„å­¸è€…ï¼Œä¸€æ—¦å‡ºä»»å‹™å°±è®Šèº«ç‚ºèº«æ‰‹çŸ¯å¥çš„å†’éšªå®¶ã€‚1936å¹´ï¼Œç¾åœ‹æ”¿åºœæ‰¾ä¸Šä»–ï¼Œå¸Œæœ›ä»–æ¶åœ¨ç´ç²¹ä¹‹å‰æ‰¾åˆ°å‚³èªªä¸­è£æœ‰æ‘©è¥¿åèª¡çŸ³æ¿çš„ç´„æ«ƒã€‚ç“Šæ–¯å¸¶è‘—èˆŠæƒ…äººç‘ªéº—å®‰å±•é–‹å…¨çƒå†’éšªï¼Œå¾å°¼æ³Šçˆ¾åˆ°åŸƒåŠï¼Œèˆ‡ç´ç²¹åæ´¾è²æ´›å…‹é¬¥æ™ºé¬¥å‹‡ã€‚é›»å½±å……æ»¿åˆºæ¿€çš„å‹•ä½œå ´é¢ï¼šå·¨çŸ³è¿½é€ã€è›‡ç©´é©šé­‚ã€å¡è»Šè¿½é€æˆ°ç­‰ï¼Œç¯€å¥æ˜å¿«ç·Šæ¹Šã€‚ç´„ç¿°Â·å¨å»‰æ–¯å‰µä½œçš„é€²è¡Œæ›²ä¸»é¡Œæ°£å‹¢ç£…ç¤´ï¼Œæˆç‚ºå†’éšªé›»å½±éŸ³æ¨‚çš„å…¸ç¯„ã€‚é›»å½±å‘30-40å¹´ä»£çš„ç³»åˆ—å†’éšªç‰‡è‡´æ•¬ï¼Œèåˆäº†è€ƒå¤ã€è¶…è‡ªç„¶ã€å‹•ä½œã€å¹½é»˜ç­‰å…ƒç´ ã€‚ç“Šæ–¯å®³æ€•è›‡çš„è¨­å®šç‚ºç¡¬æ¼¢è§’è‰²å¢æ·»äººæ€§åŒ–çš„å¼±é»ã€‚çµå±€ç´„æ«ƒå±•ç¾ç¥ç§˜åŠ›é‡æ¶ˆæ»…ç´ç²¹çš„å ´é¢éœ‡æ’¼äººå¿ƒã€‚æ¦®ç²äº”é …å¥§æ–¯å¡æŠ€è¡“çé …ï¼Œå…¨çƒç¥¨æˆ¿è¶…é3.9å„„ç¾å…ƒï¼Œæˆç‚º80å¹´ä»£æœ€æˆåŠŸçš„å†’éšªç‰‡ä¹‹ä¸€ã€‚",
        audioUrl: "https://www.dropbox.com/scl/fi/dwdytpaxtrnsuv80rgmbq/Indiana-Jones-OST-1-4-Movie-Trailer-Ver.-MV-Digital-learning-youtube.mp3?rlkey=s7qrdj4zjf9rfnl48ws8bc1vs&st=5e321iev&raw=1"
    }
];

class GameEngine {
    constructor() {
        this.score = 0;
        this.currentIndex = 0;
        this.timer = null;
        this.maxTime = 30;
        this.timeLeft = this.maxTime;
        this.isLoading = false;
        this.audioContextUnlocked = false;
        
        // DOM Elements
        this.screens = {
            start: document.getElementById('start-screen'),
            game: document.getElementById('game-screen'),
            end: document.getElementById('end-screen')
        };
        this.audioPlayer = document.getElementById('bgm-player');
        this.visualizer = document.getElementById('visualizer');
        this.spinner = document.getElementById('loading-spinner');
        this.timerFill = document.getElementById('timer-fill');
        this.statusText = document.getElementById('status-text');
        this.progressFill = document.getElementById('progress-fill');
        
        // Shuffle questions
        this.questions = [...MOVIE_DATA].sort(() => Math.random() - 0.5);

        // Bind event listeners
        document.getElementById('start-btn').addEventListener('click', () => this.start());
        document.getElementById('next-btn').addEventListener('click', () => this.nextQuestion());
        document.getElementById('restart-btn').addEventListener('click', () => location.reload());
        
        // Audio context unlock for mobile devices
        this.unlockAudioContext();
    }

    unlockAudioContext() {
        const unlock = () => {
            if (this.audioContextUnlocked) return;
            
            // Create a silent buffer and play it
            const buffer = this.audioPlayer.context.createBuffer(1, 1, 22050);
            const source = this.audioPlayer.context.createBufferSource();
            source.buffer = buffer;
            source.connect(this.audioPlayer.context.destination);
            source.start(0);
            
            this.audioContextUnlocked = true;
            
            // Remove event listeners
            document.removeEventListener('touchstart', unlock);
            document.removeEventListener('touchend', unlock);
            document.removeEventListener('click', unlock);
        };
        
        document.addEventListener('touchstart', unlock, false);
        document.addEventListener('touchend', unlock, false);
        document.addEventListener('click', unlock, false);
    }

    start() {
        this.switchScreen('game');
        this.loadQuestion();
    }

    switchScreen(name) {
        Object.values(this.screens).forEach(el => el.classList.add('hidden'));
        this.screens[name].classList.remove('hidden');
    }

    loadQuestion() {
        if (this.currentIndex >= this.questions.length) {
            this.endGame();
            return;
        }

        const currentMovie = this.questions[this.currentIndex];
        
        // Update progress bar
        const progress = ((this.currentIndex + 1) / this.questions.length) * 100;
        this.progressFill.style.width = `${progress}%`;
        
        // UI Reset
        document.getElementById('current-q').innerText = this.currentIndex + 1;
        document.getElementById('result-section').classList.add('hidden');
        document.getElementById('options-container').classList.remove('hidden');
        this.visualizer.classList.remove('playing');
        this.spinner.classList.remove('hidden'); // Show spinner
        this.statusText.innerText = "éŸ³æ¨‚è¼‰å…¥ä¸­...";
        this.statusText.style.color = "#ccc";
        this.timerFill.style.transition = 'none';
        this.timerFill.style.width = '100%';
        
        // åœæ­¢ä¹‹å‰çš„è¨ˆæ™‚èˆ‡éŸ³æ¨‚
        if(this.timer) clearInterval(this.timer);
        this.audioPlayer.pause();

        // è¨­å®šéŸ³æ¨‚ä¾†æº
        this.audioPlayer.src = currentMovie.audioUrl;
        this.audioPlayer.volume = 0.6;
        
        // éŸ³æ¨‚è¼‰å…¥è™•ç†
        this.isLoading = true;

        // ç•¶éŸ³æ¨‚æº–å‚™å¥½å¯ä»¥æ’­æ”¾æ™‚
        this.audioPlayer.oncanplay = () => {
            if(this.isLoading) {
                this.isLoading = false;
                this.spinner.classList.add('hidden');
                this.visualizer.classList.add('playing');
                this.statusText.innerText = "ğŸ¶ éŸ³æ¨‚æ’­æ”¾ä¸­... è«‹çŒœæ¸¬ï¼";
                this.statusText.style.color = "var(--accent)";
                
                // å˜—è©¦æ’­æ”¾éŸ³æ¨‚
                const playPromise = this.audioPlayer.play();
                if (playPromise !== undefined) {
                    playPromise.catch(e => {
                        console.log("æ’­æ”¾å¤±æ•—:", e);
                        this.statusText.innerText = "âš ï¸ é»æ“Šç•«é¢ä»¥æ’­æ”¾éŸ³æ¨‚";
                        document.addEventListener('click', this.forcePlay.bind(this), { once: true });
                    });
                }
                
                this.startTimer();
            }
        };

        // éŒ¯èª¤è™•ç† (å¦‚æœé€£çµå£äº†)
        this.audioPlayer.onerror = () => {
            this.spinner.classList.add('hidden');
            this.statusText.innerText = "âš ï¸ éŸ³è¨Šè®€å–å¤±æ•—";
            console.error("Audio Load Error for:", currentMovie.title);
        };

        // ç”¢ç”Ÿé¸é …
        this.generateOptions(currentMovie);
    }
    
    forcePlay() {
        this.audioPlayer.play().catch(e => console.log("å¼·åˆ¶æ’­æ”¾ä¹Ÿå¤±æ•—:", e));
    }

    generateOptions(correctMovie) {
        const container = document.getElementById('options-container');
        container.innerHTML = '';

        // Get 3 unique wrong answers
        let wrongOptions = MOVIE_DATA
            .filter(m => m.id !== correctMovie.id)
            .sort(() => Math.random() - 0.5)
            .slice(0, 3);
        
        let options = [...wrongOptions, correctMovie].sort(() => Math.random() - 0.5);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt.title;
            btn.onclick = () => this.checkAnswer(opt, correctMovie, btn);
            container.appendChild(btn);
        });
    }

    startTimer() {
        this.timeLeft = this.maxTime;
        // Restore transition for countdown
        setTimeout(() => {
             this.timerFill.style.transition = 'width 1s linear';
        }, 50);

        this.timer = setInterval(() => {
            this.timeLeft--;
            const pct = (this.timeLeft / this.maxTime) * 100;
            this.timerFill.style.width = `${pct}%`;

            if (this.timeLeft <= 0) {
                this.handleTimeout();
            }
        }, 1000);
    }

    checkAnswer(selected, correct, btnElement) {
        clearInterval(this.timer);
        this.audioPlayer.pause();
        this.visualizer.classList.remove('playing');
        
        // Disable all buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        let isCorrect = selected.id === correct.id;

        if (isCorrect) {
            btnElement.classList.add('correct');
            const pointsEarned = 100 + Math.max(0, this.timeLeft * 2);
            this.score += pointsEarned;
            
            // Show points animation
            this.showPointsAnimation(btnElement, `+${pointsEarned}`, 'positive');
            
            this.statusText.innerText = "âœ… ç­”å°äº†ï¼";
            this.statusText.style.color = "var(--correct)";
        } else {
            btnElement.classList.add('wrong');
            // Highlight the correct one
            allBtns.forEach(b => {
                if(b.innerText === correct.title) b.classList.add('correct');
            });
            
            // Show points animation
            this.showPointsAnimation(btnElement, "ç­”éŒ¯äº†", 'negative');
            
            this.statusText.innerText = "âŒ ç­”éŒ¯äº†...";
            this.statusText.style.color = "var(--wrong)";
        }

        document.getElementById('score').innerText = this.score;
        setTimeout(() => this.showResult(correct), 1500);
    }
    
    showPointsAnimation(element, text, type) {
        const pointsEl = document.createElement('span');
        pointsEl.className = `score-change ${type}`;
        pointsEl.innerText = text;
        element.appendChild(pointsEl);
        
        setTimeout(() => {
            pointsEl.remove();
        }, 1000);
    }

    handleTimeout() {
        clearInterval(this.timer);
        this.audioPlayer.pause();
        this.visualizer.classList.remove('playing');
        
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => {
            b.disabled = true;
            if(b.innerText === this.questions[this.currentIndex].title) b.classList.add('correct');
        });
        
        this.statusText.innerText = "â° æ™‚é–“åˆ°ï¼";
        this.statusText.style.color = "#f44336";
        this.showResult(this.questions[this.currentIndex]);
    }

    showResult(movie) {
        document.getElementById('options-container').classList.add('hidden');
        const resDiv = document.getElementById('result-section');
        resDiv.classList.remove('hidden');
        
        document.getElementById('res-title').innerText = movie.title;
        document.getElementById('res-year').innerText = movie.year;
        document.getElementById('res-desc').innerText = movie.desc;
    }

    nextQuestion() {
        this.currentIndex++;
        this.loadQuestion();
    }

    endGame() {
        this.switchScreen('end');
        document.getElementById('final-score').innerText = this.score;
        
        let msg = "";
        if(this.score >= 1000) msg = "ğŸ¬ å½±å²å¤§å¸«ï¼å¥§æ–¯å¡éä½ è«å±¬ï¼";
        else if(this.score >= 800) msg = "ğŸ¿ è³‡æ·±å½±è¿·ï¼Œè¡¨ç¾éå¸¸å‡ºè‰²ï¼";
        else if(this.score >= 600) msg = "ğŸ“º é›»å½±æ„›å¥½è€…ï¼Œç¹¼çºŒåŠ æ²¹ï¼";
        else if(this.score >= 400) msg = "ğŸï¸ å…¥é–€ç´šå½±è¿·ï¼Œå¤šçœ‹å¹¾éƒ¨ç¶“å…¸å§ï¼";
        else msg = "ğŸ”„ æ²’é—œä¿‚ï¼Œå†è©¦ä¸€æ¬¡ï¼";
        
        document.getElementById('feedback-msg').innerText = msg;
    }
}

// Init Game
const game = new GameEngine();

</script>
</body>
</html>
